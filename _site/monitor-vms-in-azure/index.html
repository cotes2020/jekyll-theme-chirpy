<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Monitor VMs in Azure | Programming With Wolfgang</title><meta name="generator" content="Jekyll v4.1.0" /><meta property="og:title" content="Monitor VMs in Azure" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en_US" /><meta name="description" content="To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics are met. Monitoring helps you to gain insight into the status of the VMs." /><meta property="og:description" content="To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics are met. Monitoring helps you to gain insight into the status of the VMs." /><link rel="canonical" href="https://www.programmingwithwolfgang.com/monitor-vms-in-azure/" /><meta property="og:url" content="https://www.programmingwithwolfgang.com/monitor-vms-in-azure/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-03-14T15:45:17+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Monitor VMs in Azure" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"url":"https://www.programmingwithwolfgang.com/monitor-vms-in-azure/","@type":"BlogPosting","headline":"Monitor VMs in Azure","dateModified":"2018-03-14T15:45:17+01:00","datePublished":"2018-03-14T15:45:17+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.programmingwithwolfgang.com/monitor-vms-in-azure/"},"author":{"@type":"Person","name":"Wolfgang Ofner"},"description":"To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics are met. Monitoring helps you to gain insight into the status of the VMs.","@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); </script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/author/wolfgang-small.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div></div><div class="d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="nav flex-column mt-3"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/wolfgangofner" target="_blank" > <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" target="_blank" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" target="_blank" > <i class="fab fa-linkedin"></i> </a> <a href=" javascript:window.open('mailto:' + ['wolfgang','programmingwithwolfgang.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Monitor VMs in Azure</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Monitor VMs in Azure</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 14, 2018, 3:45 PM +0100" > Mar 14, 2018 <i class="unloaded">2018-03-14T15:45:17+01:00</i> </span> by <span class="author"> Wolfgang Ofner </span></div></div><div class="post-content"><p>To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics are met. Monitoring helps you to gain insight into the status of the VMs.</p><p>Windows and Linux VMs collect the following metrics out of the box:</p><ul><li>CPU percentage<li>Disk read and write in KB/s or MB/s<li>Network in and out in KB/s or MB/s</ul><p>On Windows, the Azure Virtual Machine Agent installs the IaaSDiagnostics extension which monitors and collects diagnostic data. On Linux the Microsoft.Insights.VMDaignsticsSettings extension provides the same function.</p><p>The metrics collected on a Linux VM are:</p><ul><li>CPU<li>Disk<li>Memory<li>Network<li>Packets<li>Page<li>Swap</ul><p>The metrics collected on a Windows VM are:</p><ul><li>CPU<li>Disk<li>Network<li>Memory<li>ASP.NET<li>SQL Server</ul><p>These metrics are stored in Azure Storage Tables. By default, all metrics are collected every minute as a new row in the table.</p><p><span class="fontstyle0">For Windows VMs, metric data is written to the WADPerformanceCountersTable, with aggregates of these performance counter metrics aggregated to the minute or to the hour written to tables that start with the name WADMetricsPT1M for by minute and WADMetricsPT1H for by hour.  In addition to metrics, system logs are also collected. For Linux VM’s, the Syslog is collected into the LinuxsyslogVer2v0 table. For Windows VMs, all event log entries for the three event logs (application, security and system logs) are written to the WADWindowsEventLogsTable.</span></p><p><span class="fontstyle0">Windows VMs can collect other types of logs. Diagnostic infrastructure logs (events generated by the Azure Diagnostic Agent, such as issues collecting metrics) are written to the WADDiagnosticInfrastructureLogsTable, and application logs (the trace output from your .NET  application running in the VM) are stored in the WADLogsTable. Windows VMs can also collect Event Tracing for Windows Events. These events are collected into the WADETWEventTable. (<a href="http://amzn.to/2EWNWMF" target="_blank" rel="noopener noreferrer">Source</a>) </span></p><h2 id="configure-monitoring-and-diagnostics-for-a-new-vm">Configure monitoring and diagnostics for a new VM</h2><p>To enable monitoring and diagnostics when deploying a new VM follow these steps:</p><ol><li>Go to the Marketplace, select Compute, then Windows Server, select the desired Version, for example, 2016. After selecting your OS click Create.<li>Provide the following information for your VM:<ul><li>Name<li>Disk type (SSD or HDD)<li>User name<li>Password<li>Subscription<li>An existing or new Resource group<li>Location<li>License (if available)</ul></ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/02/Entering-basic-data-for-the-new-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/02/Entering-basic-data-for-the-new-VM.jpg" alt="Entering basic data for the new VM" /></a><p> Entering basic data for the new VM</p></div><ol start="3"><li> On the next blade choose a size for your VM. There are many different configurations with different costs to choose from. After you selected one, click Select.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/02/Select-a-VM-size-according-to-your-needs.jpg"><img loading="lazy" src="/assets/img/posts/2018/02/Select-a-VM-size-according-to-your-needs.jpg" alt="Select a VM size according to your needs" /></a><p> Select a VM size according to your needs</p></div><ol start="4"><li> On the Settings blade, under the Monitoring settings select enabled for Boot diagnostics and Guest OS diagnostics. Select or create a Storage Account where the logs will be stored.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-diagnostics-when-provisioning-a-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Enable-diagnostics-when-provisioning-a-VM.jpg" alt="Enable diagnostics when provisioning a VM" /></a><p> Enable diagnostics when provisioning a VM</p></div><ol start="5"><li> After entering all your settings, you get an overview of them in the Summary blade. Click Create to start the deployment process for your VM.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/02/Summary-of-the-new-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/02/Summary-of-the-new-VM.jpg" alt="Summary of the new VM" /></a><p> Summary of the new VM</p></div><h2 id="configure-monitoring-and-diagnostics-for-an-existing-vm">Configure monitoring and diagnostics for an existing VM</h2><p>To enable monitoring and diagnostics for an existing VM follow these steps:</p><ol><li>Go to your VM in the Azure Portal.<li>Under the Monitoring section, select Diagnostics settings.<li>For Linux VMs, toggle the Status to On to enable diagnostics.<li>For Windows, you have more options<ol><li>On the Overview tab, select Enable guest-level monitoring.<li>Check the categories you want to log on the Performance counters tab. Additionally, you can set the sample rate in seconds.<li> On the Logs tab, you can configure what events the different logs (Application, Security, System, and IIS) log.<li>On the Crash dumps tap, you can enable collecting memory dumps during a crash.<li>To enable the collection diagnostic infrastructure logs, tootle Diagnostic infrastructure logs to Enabled on the Agent tab. Then select the desired log level.</ol><li>After all settings are made, select Save.</ol><h2 id="configure-alerts">Configure Alerts</h2><p>Azure enables you to configure alert rules based on the collected metrics of your VM. These alerts can be sending an email, invoking a Webhook or run a Logic App. Additionally, it is possible to send an email, an SMS or a Webhook when a specific log event is encountered.</p><h3 id="enable-alerts">Enable alerts</h3><p>To enable and configure alerts follow these steps:</p><ol><li>Navigate to your VM in the Azure Portal.<li>Under the Monitoring menu, select Alert rules.<li>Click + Add metric alert or + Add activity log alert to add a new rule.<li>On the Add rule provide a name, select the metric source, specify the condition and then select the action to take when this condition is met.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-alert-for-your-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Create-a-new-alert-for-your-VM.jpg" alt="Create a new alert for your VM" /></a><p> Create a new alert for your VM</p></div><ol start="5"><li> I checked Email owners, contributors and readers to send an email to them. Additionally, you can also enter emails to notify more people.</ol><h2 id="monitor-metrics">Monitor metrics</h2><p>You can assess the status and health of your VM by viewing its metrics in the portal, by querying the table storage for diagnostic logs or by downloading the IIS logs from Azure Storage.</p><p>To look at the metrics follow these steps:</p><ol><li>Navigate to your VM in the Azure Portal.<li>Select Metrics under the Monitoring menu.<li>On the Metrics blade, select the metrics you want to view. The selected metrics will be displayed as a graph on the right side.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/View-the-desired-metrics.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/View-the-desired-metrics.jpg" alt="View the desired metrics" /></a><p> View the desired metrics</p></div><ol start="4"><li> You can add a title and subtitle on the top of the graph and change the time range on the right side.</ol><h3 id="view-event-logs-diagnostic-infrastructure-logs-and-application-logs">View event logs, diagnostic infrastructure logs and application logs</h3><p>You can view event logs, diagnostic infrastructure logs and application logs by querying the respective tables  <span class="fontstyle0">WADWindowsEventLogsTable, WADDiagnosticInfrastructureLogsTable, WADLogsTable). This can be easily done using Visual Studio:</span></p><ol><li>Open Visual Studio<li>On the View menu, click Cloud (or Server) Explorer.<li>Expand the Azure node, then the Storage node.<li>Expand the storage account which contains the logs you want to view. Then expand Tables.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Select-a-log-using-Visual-Studio.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Select-a-log-using-Visual-Studio.jpg" alt="Select a log using Visual Studio" /></a><p> Select a log using Visual Studio</p></div><ol start="5"><li> Right-click on the table you want to query and selectOpen to display its contents.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/The-queried-logs-in-Visual-Studio.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/The-queried-logs-in-Visual-Studio.jpg" alt="The queried logs in Visual Studio" /></a><p> The queried logs in Visual Studio</p></div><h3 id="view-iis-logs">View IIS logs</h3><p>To view IIS logs using Visual Studio follow these steps:</p><ol><li>Open Visual Studio<li>On the View menu, click Server Explorer.<li>Expand the Azure node, then the Storage node. If you can’t see your storage account there right-click and select Attach external storage. In the new window, enter the name and key for your storage account.<li>Expand the storage account which contains the logs you want to view. Then expand Blobs.<li>If you don’t see the logs, go to your VM, select Diagnostic settings and on the Logs blade enable IIS logs.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Open-the-IIS-log-using-Visual-Studio.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Open-the-IIS-log-using-Visual-Studio.jpg" alt="Open the IIS log using Visual Studio" /></a><p> Open the IIS log using Visual Studio</p></div><ol start="6"><li> Right-click on wad-iis-logfiles and select view Blob container. There you can view or download the IIS logs.</ol><h3 id="view-boot-diagnostics">View Boot diagnostics</h3><p>To view the boot diagnostics follow these steps:</p><ol><li>Open your VM in the Azure Portal.<li>Select Boot diagnostics from the Support + Troubleshooting menu.<li>If you have a Windows VM, you see the login screen. Select Serial log to see and download the log file. If you have a Linux VM, you will see the log by default.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/View-Boot-diagnostics.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/View-Boot-diagnostics.jpg" alt="View Boot diagnostics" /></a><p> View Boot diagnostics</p></div><h2 id="enable-application-insights-at-runtime">Enable Application Insights at runtime</h2><p>To enable Application Insights at runtime, you first have to create a new Application Insights instance. You can do that following these steps:</p><ol><li>Go to the marketplace in the Azure Portal.<li>Search for Application Insights and click Create.<li>Provide a new, Subscription, Resource Group and Location. Leave the Application Type as ASP.NET web application.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-Application-Insights-instance.jpg">&lt;img loading="lazy" size-full" src="/assets/img/posts/2018/03/Create-a-new-Application-Insights-instance.jpg" alt="Create a new Application Insights instance to Monitor VMs" /&gt;</a><p> Create a new Application Insights instance</p></div><ol start="4"><li> Go to your WebApp, which you want to monitor.<li> Select Application Insights under the Monitoring menu.<li> On the Application Insights blade, click Select existing resource and then click on your previously created Application Insights instance.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-Application-Insights-for-your-WebApp.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Enable-Application-Insights-for-your-WebApp.jpg" alt="Enable Application Insights for your WebApp" /></a><p> Enable Application Insights for your WebApp</p></div><ol start="7"><li> Click on OK.<li> Visit your WebApp and after a couple moments, you will see live information about your WebApp.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Get-Live-Stream-information-from-Application-Insights.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Get-Live-Stream-information-from-Application-Insights.jpg" alt="Get Live Stream information from Application Insights" /></a><p> Get Live Stream information from Application Insights</p></div><h2 id="monitor-vm-workloads-by-using-azure-application-insights">Monitor VM workloads by using Azure Application Insights</h2><p>To monitor a VM workload with Azure Application Insights follow these steps:</p><ol><li>Open the IIS web server on your VM.<li>Download and install the <a href="http://go.microsoft.com/fwlink/?LinkId=506648" target="_blank" rel="noopener noreferrer">Status Monitor</a>.<li>After the Status Monitor is installed, open IIS and select the web application that you want to monitor.<li>Sign in with your Azure credentials and click on Configure settings to configure to which Application Insights you stream your data.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-Application-Insights-Status-Monitor-on-your-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Enable-Application-Insights-Status-Monitor-on-your-VM.jpg" alt="Enable Application Insights Status Monitor on your VM" /></a><p> Enable Application Insights Status Monitor on your VM</p></div><ol start="5"><li> After you configured the settings, the web application will start streaming its information to the selected Application Insights application.<li> To view these information, go to the Azure Portal and open your Application Insights instance.<li> Select Live Metrics under the Investigate menu.<li> You will see a live stream of incoming and outgoing requests, failures and the duration of the requests.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Live-Metrics-in-Application-Insights-from-the-Web-Application-running-on-IIS-on-the-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Live-Metrics-in-Application-Insights-from-the-Web-Application-running-on-IIS-on-the-VM.jpg" alt="Live Metrics in Application Insights from the Web Application running on IIS on the VM" /></a><p> Live Metrics in Application Insights from the Web Application running on IIS on the VM</p></div><h2 id="monitor-vms-using-azure-log-analytics-and-oms">Monitor VMs using Azure Log Analytics and OMS</h2><p>With Azure Log Analytics, you can collect data directly from your Azure VM and other resources in your environments into a single repository for detailed analysis. To set up Azure Log Analytics follow these steps:</p><ol><li>In the Azure Portal, go to the Marketplace and search for Log Analytics.<li>Select Log Analytics and click Create.<li>Provide a name, Subscription, Resource Group, Location, and Pricing tier, then click OK.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-Log-Analytics-instance.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Create-a-new-Log-Analytics-instance.jpg" alt="Create a new Log Analytics instance" /></a><p> Create a new Log Analytics instance</p></div><h3 id="enable-the-log-analytics-vm-extension">Enable the Log Analytics VM Extension</h3><p>After Log Analytics is created, you have to enable the Log Analytics VM Extension. The extension gets installed automatically and configures the agent to send data to the Log Analytics automatically. To set enable the Log Analytics VM Extension follow these steps:</p><ol><li>Go to your Log Analytics in the Azure Portal.<li>Select Virtual machines under the Workspace Data Sources menu and select the VM you want to install the agent on.<li>On the Virtual machine blade, click on Connect. This installs the agent and configures it for your Log Analytics workspace.<li>After the installation is completed, the OMS connection status will change to This workspace.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Installing-the-agent-on-your-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Installing-the-agent-on-your-VM.jpg" alt="Installing the agent on your VM" /></a><p> Installing the agent on your VM</p></div><h3 id="collect-event-and-performance-data">Collect event and performance data</h3><p>Log Analytics can collect events from the Windows event logs or Linux Syslog and performance and also take action when a particular condition is detected. To set it up, follow these steps:</p><ol><li>Go to Log Analytics in the Azure Portal.<li>Select Advanced settings under the Settings menu.<li>Select Data and then select Windows Event Logs.<li>Add a new event log by entering a name and then clicking +.<li>After the log is created, select the desired log level.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-Log-for-information-from-your-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Create-a-new-Log-for-information-from-your-VM.jpg" alt="Create a new Log for information from your VM" /></a><p> Create a new Log for information from your VM</p></div><ol start="6"><li> Select Windows Performance Counters and enable your desired performance counters.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Select-your-desired-performance-counters.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Select-your-desired-performance-counters.jpg" alt="Select your desired performance counters" /></a><p> Select your desired performance counters</p></div><ol start="7"><li> Click Save.</ol><h3 id="view-the-collected-data">View the collected data</h3><p>After data collection is set up, you can run searches in your log. To do that, follow these steps:</p><ol><li>Open your Log Analytics in the Azure Portal.<li>Click Log Search under the General menu.<li>The Log Search blade already suggests a couple of queries and the search box also makes suggestions based on your input. For example, you could enter Usage and click the Search icon which will give you various information about the usage of your VM.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Search-the-logs-for-the-usage-of-your-VM.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Search-the-logs-for-the-usage-of-your-VM.jpg" alt="Search the logs for the usage of your VM" /></a><p> Search the logs for the usage of your VM</p></div><h3 id="monitor-your-network-topology">Monitor your network topology</h3><p>After you deployed your Network Watcher, you can look at the topology of your network by following these steps:</p><ol><li>Click on Topology under the Monitoring menu.<li>On the Topology blade select your Subscription, Resource group, and Virtual Network.<li>Your network will be displayed you can download it by clicking on Download topology</ol><h2 id="monitor-your-network">Monitor your network</h2><p>To monitor and diagnose your network, Azure has a service called Network Watcher. The Network Watcher can visualize your network and therefore can help you to understand, diagnose and gain insights into your network in Azure. Following, I will talk about some features of the Network Watcher.</p><h3 id="create-a-network-watcher">Create a Network Watcher</h3><p>To enable a Network Watcher follow these steps:</p><ol><li>In the Azure Portal, click on All services and search for Network Watcher and select the result.<li>On the Overview blade of your Network Watcher, enable the regions you want to monitor in the drop-down list.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-Network-Watchers-in-your-desired-location.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Enable-Network-Watchers-in-your-desired-location.jpg" alt="Enable Network Watchers in your desired location" /></a><p> Enable Network Watchers in your desired location</p></div><h3 id="monitor-the-topology-of-your-network">Monitor the topology of your network</h3><p>After your Network Watcher is deployed, you can take a look at the topology of your network. To do that follow these steps:</p><ol><li>In your Network Watcher, click on Topology under the Monitoring menu.<li>On the Topology blade, select a Subscription, Resource Group, and a Virtual Network.<li>After a couple of seconds, your network will be displayed. You can also download the topology by clicking on Download topology.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Topology-with-virtual-machines-and-network-cards.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Topology-with-virtual-machines-and-network-cards.jpg" alt="Topology with virtual machines and network cards" /></a><p> Topology with virtual machines and network cards</p></div><h3 id="monitor-your-network-limits">Monitor your network limits</h3><p>You can only have a certain amount of network resources per subscription. The Network Watcher lists all used resources and makes it easy to monitor them. To do that follow these steps:</p><ol><li>In your Network Watcher, click on Network subscription limit.<li>Select a Subscription and Location.<li>The Portal will list all resources, the current limit, and your usage.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Overview-of-the-Network-subscription-limit.jpg"><img loading="lazy" src="/assets/img/posts/2018/03/Overview-of-the-Network-subscription-limit.jpg" alt="Overview of the Network subscription limit" /></a><p> Overview of the Network subscription limit</p></div><h2 id="conclusion">Conclusion</h2><p>In this post, I showed how to enable monitoring and diagnostics when deploying a new VM as well as for an existing VM. The next section talked about Application Insights and how to monitor WebApps and also application running on IIS on a VM. Next, I showed how to monitor your VMs with Log Analytics and how to filter these logs. The last part was a short overview of the Network Watcher and how to monitor your network with it.</p><p>For more information about the 70-532 exam get the <a href="http://amzn.to/2EWNWMF" target="_blank" rel="noopener noreferrer">Exam Ref book from Microsoft</a> and continue reading my blog posts. I am covering all topics needed to pass the exam. You can find an overview of all posts related to the 70-532 exam <a href="/prepared-for-the-70-532-exam/" target="_blank" rel="noopener noreferrer">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cloud/'>Cloud</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/70-532/" class="post-tag no-text-decoration">70-532</a> <a href="/tags/azure/" class="post-tag no-text-decoration">Azure</a> <a href="/tags/certification/" class="post-tag no-text-decoration">Certification</a> <a href="/tags/exam/" class="post-tag no-text-decoration">Exam</a> <a href="/tags/learning/" class="post-tag no-text-decoration">learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Monitor VMs in Azure - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/monitor-vms-in-azure/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Monitor VMs in Azure - Programming With Wolfgang&u=https://www.programmingwithwolfgang.com/monitor-vms-in-azure/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Monitor VMs in Azure - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/monitor-vms-in-azure/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.programmingwithwolfgang.com/monitor-vms-in-azure/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/mediatr/">MediatR</a> <a class="post-tag" href="/tags/cqrs/">CQRS</a> <a class="post-tag" href="/tags/xunit/">xUnit</a> <a class="post-tag" href="/tags/docker-compose/">docker compose</a> <a class="post-tag" href="/tags/swagger/">Swagger</a> <a class="post-tag" href="/tags/scrum/">Scrum</a> <a class="post-tag" href="/tags/agile/">Agile</a> <a class="post-tag" href="/tags/rabbitmq/">RabbitMQ</a> <a class="post-tag" href="/tags/ci/">CI</a> <a class="post-tag" href="/tags/mvc/">MVC</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/prepared-for-the-70-532-exam/"><div class="card-body"> <span class="timeago small" > Feb 23, 2018 <i class="unloaded">2018-02-23T14:33:48+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I prepared for the 70-532 Exam</h3><div class="text-muted small"><p> Recently I started to prepare for the Microsoft certification exam 70-532 “Developing Microsoft Azure Solutions” using the official Exam Ref book. This post contains a comprehensive list of blog po...</p></div></div></a></div><div class="card"> <a href="/deploy-workload-on-azure-arm-virtual-machines/"><div class="card-body"> <span class="timeago small" > Mar 5, 2018 <i class="unloaded">2018-03-05T14:18:57+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploy workload on Azure ARM virtual machines</h3><div class="text-muted small"><p> Azure ARM virtual machines can run a lot of different operating systems. In this posts, I will give an overview of these different types and I will also show how to create them in the Azure Portal....</p></div></div></a></div><div class="card"> <a href="/perform-configuration-management/"><div class="card-body"> <span class="timeago small" > Mar 6, 2018 <i class="unloaded">2018-03-06T12:21:11+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Perform Configuration Management</h3><div class="text-muted small"><p> In this post, I want to show how to use Windows PowerShell Desired State Configuration (DSC) and the VM Agent to perform various configuration management tasks like remote debugging and at the end,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/design-implement-arm-vm-azure-storage/" class="btn btn-outline-primary"><p>Design and implement ARM VM Azure Storage</p></a> <a href="/manage-arm-vm-availability/" class="btn btn-outline-primary"><p>Manage ARM VM Availability</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//programmingwithwolfgang.disqus.com/embed.js', disqusConfig: function () { this.page.url = 'https://www.programmingwithwolfgang.com/monitor-vms-in-azure/'; this.page.identifier = '/monitor-vms-in-azure/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/wolfgang_ofner">Wolfgang Ofner</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/mediatr/">MediatR</a> <a class="post-tag" href="/tags/cqrs/">CQRS</a> <a class="post-tag" href="/tags/xunit/">xUnit</a> <a class="post-tag" href="/tags/docker-compose/">docker compose</a> <a class="post-tag" href="/tags/swagger/">Swagger</a> <a class="post-tag" href="/tags/scrum/">Scrum</a> <a class="post-tag" href="/tags/agile/">Agile</a> <a class="post-tag" href="/tags/rabbitmq/">RabbitMQ</a> <a class="post-tag" href="/tags/ci/">CI</a> <a class="post-tag" href="/tags/mvc/">MVC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.programmingwithwolfgang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
