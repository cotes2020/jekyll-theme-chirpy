<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Dockerize an ASP .NET Core Microservice and RabbitMQ | Programming With Wolfgang</title><meta name="generator" content="Jekyll v4.1.0" /><meta property="og:title" content="Dockerize an ASP .NET Core Microservice and RabbitMQ" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en_US" /><meta name="description" content="In my last post, I added RabbitMQ to my two microservices which finished all the functional requirements. Microservices became so popular because they can be easily deployed using Docker. Today I will dockerize my microservices and create Docker container which can be run anywhere as long as Docker is installed. I will explain most of the Docker commands but basic knowledge about starting and stopping containers is recommended." /><meta property="og:description" content="In my last post, I added RabbitMQ to my two microservices which finished all the functional requirements. Microservices became so popular because they can be easily deployed using Docker. Today I will dockerize my microservices and create Docker container which can be run anywhere as long as Docker is installed. I will explain most of the Docker commands but basic knowledge about starting and stopping containers is recommended." /><link rel="canonical" href="http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/" /><meta property="og:url" content="http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-21T11:24:50+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Dockerize an ASP .NET Core Microservice and RabbitMQ" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"url":"http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/","@type":"BlogPosting","headline":"Dockerize an ASP .NET Core Microservice and RabbitMQ","dateModified":"2020-04-21T11:24:50+02:00","datePublished":"2020-04-21T11:24:50+02:00","author":{"@type":"Person","name":"Wolfgang Ofner"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/"},"description":"In my last post, I added RabbitMQ to my two microservices which finished all the functional requirements. Microservices became so popular because they can be easily deployed using Docker. Today I will dockerize my microservices and create Docker container which can be run anywhere as long as Docker is installed. I will explain most of the Docker commands but basic knowledge about starting and stopping containers is recommended.","@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/author/wolfgang-small.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div></div><div class="d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="nav flex-column mt-3"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/wolfgangofner" target="_blank" > <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" target="_blank" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" target="_blank" > <i class="fab fa-linkedin"></i> </a> <a href=" javascript:window.open('mailto:' + ['wolfgang','programmingwithwolfgang.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Dockerize an ASP .NET Core Microservice and RabbitMQ</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Dockerize an ASP .NET Core Microservice and RabbitMQ</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Apr 21, 2020, 11:24 AM +0200" > Apr 21 <i class="unloaded">2020-04-21T11:24:50+02:00</i> </span> by <span class="author"> Wolfgang Ofner </span></div></div><div class="post-content"><p><a href="/rabbitmq-in-an-asp-net-core-3-1-microservice/" target="_blank" rel="noopener noreferrer">In my last post</a>, I added RabbitMQ to my two microservices which finished all the functional requirements. Microservices became so popular because they can be easily deployed using Docker. Today I will dockerize my microservices and create Docker container which can be run anywhere as long as Docker is installed. I will explain most of the Docker commands but basic knowledge about starting and stopping containers is recommended.</p><h2 id="what-is-docker">What is Docker?</h2><p>Docker is the most popular container technology. It is written in Go and open-source. A container can contain a Windows or Linux application and will run the same, no matter where you start it. This means it runs the same way during development, on the testing environment, and on the production environment. This eliminates the famous “It works on my machine”.</p><p>Another big advantage is that Docker containers share the host system kernel. This makes them way smaller than a virtual machine and enables them to start within seconds or even less. For more information about Docker, check out <a href="https://www.docker.com/resources/what-container" target="_blank" rel="noopener noreferrer">Docker.com</a>. There you can also download Docker Desktop which you will need to run Docker container on your machine.</p><h2 id="what-is-dockerhub">What is Dockerhub?</h2><p><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Dockerhub</a> is like GitHub for Docker containers. You can sign up for free and get unlimited public repos and one private repo. There are also enterprise plans which give you more private repos, build pipelines for your containers and security scanning.</p><p>To Dockerize an application means that you create a Docker container or at least a Dockerfile which describes how to create the container. You can upload the so-called container image to container registries like Dockerhub so other developers can easily download and run it.</p><p>Dockerhub is the go-to place if you want to download official container images. The RabbitMQ from the last post was downloaded from there or you can download Redis, SQL Server from Microsoft or thousands of other popular applications.</p><h2 id="dockerize-the-microservices">Dockerize the Microservices</h2><p>You can find the code of  the finished demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>Visual Studio makes it super easy to dockerize your application. All you have to do it to right-click on the API project and then select Add –&gt; Docker Support.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Dockerize-your-application.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Dockerize-your-application.jpg" alt="Dockerize your application" /></a><p> Dockerize your application</p></div><p>This opens a new window where you can select Linux or Windows as OS for the container. I am always going for Linux as my default choice because the image is way smaller than Windows and therefore starts faster. Also, all my other containers run on Linux and on Docker Desktop, you can only run containers with the same OS at a time. After clicking OK, the Dockerfile and .dockerignore files are added. That’s all you have to do to dockerize the application.</p><h3 id="dockerfile-and-dockerignore-files">Dockerfile and .dockerignore Files</h3><p>The .dockerignore file is like the .gitignore file and contains extensions and paths which should not be copied into the container. Default extensions in the .dockerignore file are .vs, /bin or /obj. The .dockerignore file is not required to dockerize your application but highly recommended.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Content-of-the-.dockerignore-file.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Content-of-the-.dockerignore-file.jpg" alt="Content of the .dockerignore file" /></a><p> Content of the .dockerignore file</p></div><p>The Dockerfile is a set of instructions to build and run an image. Visual Studio creates a multi-stage Dockerfile which means that it builds the application but only adds necessary files and images to the container image. The Dockerfile uses the .NET Core SDK to build the image but uses the way smaller .NET Core runtime image inside of the container. Let’s take a look at the different stages of the Dockerfile.</p><h3 id="understanding-the-multi-stage-dockerfile">Understanding the multi-stage Dockerfile</h3><div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim AS base  </span>
<span class="k">WORKDIR</span><span class="s"> /app  </span>
<span class="k">EXPOSE</span><span class="s"> 80  </span>
<span class="k">EXPOSE</span><span class="s"> 443  </span>
</pre></table></code></div></div><p>The first part downloads the .NET Core runtime 3.1 image from Docker hub and gives it the name base which will be used later on. Then it sets the working directory to /app which will also be later used. Lastly, the ports 80 and 443 are exposed which tells Docker to listen to these two ports when the container is running.</p><div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/sdk:3.1-buster AS build  </span>
<span class="k">WORKDIR</span><span class="s"> /src  </span>
<span class="k">COPY</span><span class="s"> ["CustomerApi/CustomerApi.csproj", "CustomerApi/"]  </span>
<span class="k">COPY</span><span class="s"> ["CustomerApi.Domain/CustomerApi.Domain.csproj", "CustomerApi.Domain/"]  </span>
<span class="k">COPY</span><span class="s"> ["CustomerApi.Messaging.Send/CustomerApi.Messaging.Send.csproj", "CustomerApi.Messaging.Send/"]  </span>
<span class="k">COPY</span><span class="s"> ["CustomerApi.Service/CustomerApi.Service.csproj", "CustomerApi.Service/"]  </span>
<span class="k">COPY</span><span class="s"> ["CustomerApi.Data/CustomerApi.Data.csproj", "CustomerApi.Data/"]  </span>
<span class="k">RUN </span>dotnet restore <span class="s2">"CustomerApi/CustomerApi.csproj"</span>  
<span class="k">COPY</span><span class="s"> . .  </span>
<span class="k">WORKDIR</span><span class="s"> "/src/CustomerApi"  </span>
<span class="k">RUN </span>dotnet build <span class="s2">"CustomerApi.csproj"</span> <span class="nt">-c</span> Release <span class="nt">-o</span> /app/build  
</pre></table></code></div></div><p>The next section downloads the .NET Core 3.1 SDK from Dockerhub and names it build. Then the working directory is set to /src and all project files (except test projects) of the solution are copied inside the container. Then dotnet restore is executed to restore all NuGet packages and the working directory is changed to the directory of the API project. Note that the path starts with /src, the working directory path I set before I copied the files inside the container. Lastly, dotnet build is executed which builds the project with the Release configuration into the path /app/build.</p><div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> build AS publish  </span>
<span class="k">RUN </span>dotnet publish <span class="s2">"CustomerApi.csproj"</span> <span class="nt">-c</span> Release <span class="nt">-o</span> /app/publish  
</pre></table></code></div></div><p>The build image in the first line of the next section is the SDK image which we downloaded before and named build. We use it to run dotnet publish which publishes the CustomerApi project.</p><div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> base AS final  </span>
<span class="k">WORKDIR</span><span class="s"> /app  </span>
<span class="k">COPY</span><span class="s"> &amp;#8211;from=publish /app/publish .  </span>
<span class="k">ENTRYPOINT</span><span class="s"> ["dotnet", "CustomerApi.dll"]  </span>
</pre></table></code></div></div><p>The last section uses the runtime image and sets the working directory to /app. Then the published files from the last step are copied into the working directory. The dot means that it is copied to your current location, therefore /app. The Entrypoint command tells Docker to configure the container as an executable and to run the CustomerApi.dll when the container starts.</p><p>For more details on the Dockerfile and .dockerignore file check out the <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener noreferrer">official documentation</a>.</p><h2 id="test-the-dockerized-application">Test the Dockerized Application</h2><p>After adding the Docker support to your application, you should be able to select Docker as a startup option in Visual Studio. When you select Docker for the first time, Visual Studio will run the Dockerfile, therefore build and create the container. This might take a bit because the images for the .NET Core runtime and SDK need to be downloaded. After the first download, they are cached and can be quickly reused.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Select-Docker-as-startup-option.jpg">&lt;img loading="lazy" size-full" src="/assets/img/posts/2020/04/Select-Docker-as-startup-option.jpg" alt="Dockerize the application and select Docker as startup option" /&gt;</a><p> Select Docker as startup option</p></div><p>Click F5 or on the Docker button and your application should start as you are used to. If you don’t believe me that it is running inside a Docker container, you can check the running containers in PowerShell with the command docker ps.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Check-the-running-containers.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Check-the-running-containers.jpg" alt="Check the running containers" /></a><p> Check the running containers</p></div><p>The screenshot above shows that the customerapi image was started two minutes ago, that it is running for two minutes and that it maps the port 32789 to port 80 and 32788 to 433. To stop a running container, you can use docker stop [id]. In my case. this would be docker stop f25727f43d6b. You don’t have to use the full id, like in git. Docker only needs to clearly identify the image you want to stop. So you could use docker stop f25.</p><h2 id="build-the-dockerfile-without-visual-studio">Build the Dockerfile without Visual Studio</h2><p>You don’t need Visual Studio to create a Docker image. This is useful when you want to create the image and then push it to a container registry like Docker hub. You should always do this in a build pipeline but its useful to know how to do it by hand and sometimes you need it to quickly test something.</p><p>Open Powershell and navigate to the folder containing the CustomerApi.sln file. To build an image, you can use docker build [build context] [location of Dockerfile]. Optionally, you can add a tag by using -t Tagname. Use</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="nx">customerapi</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">CustomerApi/Dockerfile</span><span class="w">  
</span></pre></table></code></div></div><p>to build the Dockerfile which is in your current file with the tag name customerapi. This will download the needed images (or use them from the cache) and start to build your image. Step 7 fails because a directory can’t be found though.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Build-the-docker-image.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Build-the-docker-image.jpg" alt="Build the docker image" /></a><p> Build the docker image</p></div><p>To confirm that your image was really created, use docker images.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Confirm-that-the-image-was-created.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Confirm-that-the-image-was-created.jpg" alt="Confirm that the image was created" /></a><p> Confirm that the image was created</p></div><h3 id="start-the-newly-built-image">Start the newly built Image</h3><p>To start an image use docker run [-p “port outside of the container”:”port inside the container”] name of the image to start. In my example:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">32789:80</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">32788:443</span><span class="w"> </span><span class="nx">customerapi</span><span class="w"> </span><span class="o">.</span><span class="w">  
</span></pre></table></code></div></div><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Run-the-previously-created-image.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Run-the-previously-created-image.jpg" alt="Run the previously created image dockerize" /></a><p> Run the previously created image</p></div><p>After the container is started, open localhost:32789 and you should see the Swagger UI of the API. If you use the HTTP port, you will get a connection closed error. HTTPS is currently not working because we have to provide a certificate so kestrel can process HTTPs requests. I will explain <a href="/asp-net-core-with-https-in-docker" target="_blank" rel="noopener noreferrer">in my next post</a> how to add a certificate to the container. For now, I will only use the HTTP port.</p><h3 id="push-the-image-to-dockerhub">Push the Image to Dockerhub</h3><p>We confirmed that the image is running, and now it is time to share it and therefore to upload it to Dockerhub. Dockerhub is the default registry in Docker Desktop. Use docker login to login in your Dockerhub account.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Log-in-into-Dockerhub.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Log-in-into-Dockerhub.jpg" alt="Log in into Dockerhub" /></a><p> Log in into Dockerhub</p></div><p>Next, I have to tag the image I want to upload with the name of my Dockerhub account and the name of the repository I want to use. I do this with docker tag Image DockerhubAccount/repository.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">tag</span><span class="w"> </span><span class="nx">customerapi</span><span class="w"> </span><span class="nx">wolfgangofner/customerapi</span><span class="w">  
</span></pre></table></code></div></div><p>The last step is to push the image to Dockerhub using docker push tagname.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">push</span><span class="w"> </span><span class="nx">wolfgangofner/customerapi</span><span class="w">  
</span></pre></table></code></div></div><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Push-the-image-to-Dockerhub.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Push-the-image-to-Dockerhub.jpg" alt="Push the image to Dockerhub dockerize" /></a><p> Push the image to Dockerhub</p></div><p>To confirm that the image was pushed to Dockerhub, I open my repositories and see the newly create customerapi there.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Confirm-that-the-image-was-pushed-to-Dockerhub.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Confirm-that-the-image-was-pushed-to-Dockerhub.jpg" alt="Confirm that the image was pushed to Dockerhub dockerize" /></a><p> Confirm that the image was pushed to Dockerhub</p></div><h3 id="testing-the-uploaded-image">Testing the uploaded Image</h3><p>To confirm that everything worked fine, I will download the image and run it on any machine. The only requirement is that Docker is installed. When you click on the repository, you can see the command to download the image. In my example, this is docker pull wolfgangofner/customerapi. I will use docker run because this runs the image and if it is not available automatically pull it too.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">32789:80</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">32788:443</span><span class="w"> </span><span class="nx">wolfgangofner/customerapi</span><span class="w">  
</span></pre></table></code></div></div><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/04/Run-the-previously-uploaded-image.jpg"><img loading="lazy" src="/assets/img/posts/2020/04/Run-the-previously-uploaded-image.jpg" alt="Run the previously uploaded image dockerize" /></a><p> Run the previously uploaded image</p></div><p>Open localhost:32789 and the Swagger UI will appear.</p><p>For practice purposes, you can dockerize the OrderApi. The steps are identical to the steps for the CustomerApi.</p><h2 id="conclusion">Conclusion</h2><p>Today, I showed how to dockerize the microservices to create immutable Docker images which I can easily share using Dockerhub and run everywhere the same way. Currently, only the HTTP port of the application works because we haven’t provided an SSL certificate to process HTTPS requests. <a href="/asp-net-core-with-https-in-docker" target="_blank" rel="noopener noreferrer">In my next post</a>, I will create a development certificate and start the image with it.</p><p>Note: On October 11, I removed the Solution folder and moved the projects to the root level. I also edited this post to reflect the changes. Over the last months I made the experience that this makes it quite simpler to work with Dockerfiles and have automated builds and deployments.</p><p>You can find the code of  the finished demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">GitHub</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/docker/'>Docker</a>, <a href='/categories/asp.net/'>ASP.NET</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/net-core-3.1/" class="post-tag no-text-decoration">NET Core 3.1</a> <a href="/tags/c%23/" class="post-tag no-text-decoration">C#</a> <a href="/tags/cqrs/" class="post-tag no-text-decoration">CQRS</a> <a href="/tags/docker/" class="post-tag no-text-decoration">docker</a> <a href="/tags/docker-compose/" class="post-tag no-text-decoration">docker-compose</a> <a href="/tags/mediatr/" class="post-tag no-text-decoration">MediatR</a> <a href="/tags/microservice/" class="post-tag no-text-decoration">microservice</a> <a href="/tags/rabbitmq/" class="post-tag no-text-decoration">RabbitMQ</a> <a href="/tags/swagger/" class="post-tag no-text-decoration">Swagger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dockerize an ASP .NET Core Microservice and RabbitMQ - Programming With Wolfgang&url=http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dockerize an ASP .NET Core Microservice and RabbitMQ - Programming With Wolfgang&u=http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Dockerize an ASP .NET Core Microservice and RabbitMQ - Programming With Wolfgang&url=http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/build-docker-azure-devops-ci-pipeline/">Build Docker in an Azure DevOps CI Pipeline</a><li><a href="/whats-new-c-sharp-7/">Whats new in C# 7.0</a><li><a href="/whats-new-c-sharp-6/">Whats new in C# 6.0</a><li><a href="/we-moved-to-jekyll/">We moved to Jekyll</a><li><a href="/view-components-in-asp-net-core-mvc/">View Components in ASP.NET Core MVC</a></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xunit/">xUnit</a> <a class="post-tag" href="/tags/mediatr/">MediatR</a> <a class="post-tag" href="/tags/cqrs/">CQRS</a> <a class="post-tag" href="/tags/docker-compose/">docker compose</a> <a class="post-tag" href="/tags/swagger/">Swagger</a> <a class="post-tag" href="/tags/scrum/">Scrum</a> <a class="post-tag" href="/tags/ci/">CI</a> <a class="post-tag" href="/tags/agile/">Agile</a> <a class="post-tag" href="/tags/rabbitmq/">RabbitMQ</a> <a class="post-tag" href="/tags/mvc/">MVC</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/programming-microservices-net-core-3-1/"><div class="card-body"> <span class="timeago small" > Apr 13 <i class="unloaded">2020-04-13T17:53:40+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Programming a Microservice with .NET Core 3.1</h3><div class="text-muted small"><p> In my last post, I talked about the theory of a microservice. Today it is going to be more practical. I will create two microservices using ASP .NET Core 3.1. Over the next posts., I will extend th...</p></div></div></a></div><div class="card"> <a href="/document-your-microservice-with-swagger/"><div class="card-body"> <span class="timeago small" > Apr 15 <i class="unloaded">2020-04-15T17:37:49+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Document your Microservice with Swagger</h3><div class="text-muted small"><p> Swagger is an open-source toolset that can be easily integrated into your solution and which helps you to document and test your APIs. It is so simple that even none technical people can use it. In...</p></div></div></a></div><div class="card"> <a href="/mediator-pattern-in-asp-net-core-3-1/"><div class="card-body"> <span class="timeago small" > Apr 17 <i class="unloaded">2020-04-17T14:05:38+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mediator Pattern in ASP .NET Core 3.1</h3><div class="text-muted small"><p> The mediator pattern is a behavioral design pattern that helps to reduce chaotic dependencies between objects. The main goal is to disallow direct communication between the objects and instead forc...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/rabbitmq-in-an-asp-net-core-3-1-microservice/" class="btn btn-outline-primary"><p>RabbitMQ in an ASP .NET Core 3.1 Microservice</p></a> <a href="/asp-net-core-with-https-in-docker/" class="btn btn-outline-primary"><p>ASP .NET Core with HTTPS in Docker</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//programmingwithwolfgang.disqus.com/embed.js', disqusConfig: function () { this.page.url = 'http://0.0.0.0:4000/dockerize-an-asp-net-core-microservice-and-rabbitmq/'; this.page.identifier = '/dockerize-an-asp-net-core-microservice-and-rabbitmq/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/wolfgang_ofner">Wolfgang Ofner</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/xunit/">xUnit</a> <a class="post-tag" href="/tags/mediatr/">MediatR</a> <a class="post-tag" href="/tags/cqrs/">CQRS</a> <a class="post-tag" href="/tags/docker-compose/">docker compose</a> <a class="post-tag" href="/tags/swagger/">Swagger</a> <a class="post-tag" href="/tags/scrum/">Scrum</a> <a class="post-tag" href="/tags/ci/">CI</a> <a class="post-tag" href="/tags/agile/">Agile</a> <a class="post-tag" href="/tags/rabbitmq/">RabbitMQ</a> <a class="post-tag" href="/tags/mvc/">MVC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://0.0.0.0:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
