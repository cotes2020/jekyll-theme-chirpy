---
title: "æ·±å…¥å‡½æ•°å¼ç¼–ç¨‹(FP)"
date: 2021-09-01
permalink: /2021-09-01-fp/
tags: [å‡½æ•°å¼ç¼–ç¨‹]
---

## FPçš„è¦æ±‚


åœ¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸–ç•Œé‡Œé¢ï¼š

- functionå¿…é¡»æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚ä¸€ç­‰å…¬æ°‘æ˜¯æŒ‡functionå¯ä»¥ä½œä¸ºä¸€ä¸ªfunctionå‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºfunctionè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡æˆ–è€…å…¶ä»–å¯¹è±¡å±æ€§ã€‚

	JavaScriptä¸­ï¼Œfunctionå°±æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚

- å¼•ç”¨é€æ˜ã€‚åŒæ ·çš„in paramsï¼Œä¸è®ºå¤šå°‘æ¬¡ï¼Œè¿”å›å¿…é¡»è¦ä¸€æ ·ï¼Œæ²¡æœ‰é€ æˆå‰¯ä½œç”¨ï¼ˆside effectï¼‰ï¼Œå‡½æ•°æ˜¯çº¯å‡½æ•°ï¼ˆpure functionï¼‰ã€‚

	ä»€ä¹ˆæ˜¯Side Effectï¼Ÿä¿®æ”¹ä¼ å…¥çš„å‚æ•°ã€å¤–éƒ¨çŠ¶æ€ã€å‘é€httpè¯·æ±‚ã€dbæŸ¥è¯¢ã€æ‰“å°logã€è·å–inputã€domæŸ¥è¯¢ã€è®¿é—®ï¼ˆç³»ç»Ÿï¼‰çŠ¶æ€ç­‰ç­‰

- å°†ç®€å•çš„æŒ‡ä»¤å¼è°ƒç”¨å°è£…ä¸ºå‡½æ•°ã€‚ä¾‹å¦‚ğŸ‘‡

```typescript
function formatter(formatFn) {
    return function inner(str){
        return formatFn( str );
    };
}

var lower = formatter( function (v){
    return v.toLowerCase();
} );
```


## FPçš„ä¼˜åŠ¿

- ä½å¤æ‚åº¦ï¼šfunctionä¸ä¼šæœ‰çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šç›´æ¥å­˜å–æˆ–è¯»å–å¤–æ¥çŠ¶æ€ã€‚å¯¹äºç›¸åŒè¾“å…¥ï¼Œä¸€å®šä¼šæœ‰ç›¸åŒè¾“å‡ºã€‚
- æ— éœ€è¯­å¥ï¼ˆstatementï¼‰ï¼šæ‰€æœ‰Pure Functional Programming Languages éƒ½æ˜¯ç”±è¡¨è¾¾å¼(expression) æ‰€ç»„æˆçš„ï¼Œè¿™è·Ÿå…¶ä»–å¤§å¤šæ•°è¯­è¨€ä¸åŒï¼Œå¤§å¤šæ•°ç¨‹å¼è¯­è¨€ç”±è¡¨è¾¾å¼(expression) å’Œè¯­å¥(statement) ç»„æˆã€‚

## Pure Function


çº¯å‡½æ•°æ˜¯æŒ‡æ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ã€‚åœ¨jsä¸­ï¼Œæœ€å¸¸è§çš„æ˜¯å¦‚æœå°†å¯¹è±¡ä¼ ç»™å‚æ•°ï¼Œé‚£ä¹ˆå‡½æ•°æ‹¿åˆ°çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œå†…éƒ¨å°±å¯èƒ½ä¼šä¿®æ”¹å¤–éƒ¨æ•°æ®çŠ¶æ€ï¼Œå‡½æ•°ä¸å†pureäº†ã€‚


å¯ä»¥ä½¿ç”¨ä¸å¯å˜æ•°æ®æ¥é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥å‚è€ƒ [ImmutableJS å®æˆ˜](https://www.notion.so/a60a508d75a1470080d65f5df2090d4c) ã€ES6è¯­æ³•ä¸­çš„let/constä¸`Object.freeze()/Object.isFrozen()`


## Higher-order Function


é«˜é˜¶å‡½æ•°æ˜¯è‡³å°‘æ»¡è¶³ä¸‹åˆ—ä¸€ä¸ªæ¡ä»¶çš„å‡½æ•°ï¼š

- æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºè¾“å…¥
- è¾“å‡ºä¸€ä¸ªå‡½æ•°

## Closure


> **é—­åŒ…å®šä¹‰**  
> å½“ä¸€ä¸ªå‡½æ•°å¯ä»¥è®°ä½å¹¶å­˜å–åˆ°ä¸åŒscope(ä½œç”¨åŸŸ)çš„å˜é‡ï¼Œç”šè‡³è¿™ä¸ªå‡½æ•°åœ¨ä¸åŒscopeè¢«æ‰§è¡Œï¼Œç§°ä¹‹Closure


ä¸¾ä¸ªä¾‹å­ï¼š


```typescript
function greaterThan(n) {
  return function inner (m) { return m > n; };
}

var greaterThan10 = greaterThan(10);

console.log(greaterThan10(11)); // true
```


nçš„scopreæ˜¯greaterThanã€‚greaterThanè¿è¡Œä¹‹åï¼ŒæŒ‰ç†è¯´nåº”è¯¥è¢«å›æ”¶ã€‚ä½†æ˜¯ç”±äºinnerä¸­ç”¨åˆ°äº†nï¼Œæ‰€ä»¥å®ƒè¢«â€œæš‚æ—¶ä¿ç•™â€äº†ä¸‹æ¥ã€‚**è¿™ä¸ªç§°ä¹‹ä¸ºï¼šnè¢«å†…éƒ¨å‡½æ•°inner** **`closure`****ã€‚**


## Partial Application


**åå‡½æ•°åº”ç”¨å®šä¹‰**ï¼špartial applicationæ˜¯æŒ‡ä¸€ç§å‡å°‘å‡½æ•°å‚æ•°ä¸ªæ•°`Arity`çš„è¿‡ç¨‹ã€‚


> **ä»€ä¹ˆ** **`Arity`****ï¼Ÿ**  
> æŒ‡çš„æ˜¯å½¢å¼å‚æ•°parameterçš„ä¸ªæ•°ã€‚jsä¸­å¯ä»¥é€šè¿‡func.lengthè·å–åˆ°å¿…å¡«å‚æ•°çš„ä¸ªæ•°ã€‚


åå‡½æ•°å·¥å…·å‡½æ•°å®ç°ï¼š


```typescript
function partial(fn, ...presetArgs) {
    return function partiallyApplied(...laterArgs) {
        return fn( ...presetArgs, ...laterArgs )
    }
}
```


å¯ä»¥åˆ©ç”¨åå‡½æ•°ï¼ŒåŸºäºåŸºç¡€å‡½æ•°ï¼ˆå‚æ•°å¤šï¼Œæ›´çµæ´»ï¼‰ï¼ŒäºŒæ¬¡å°è£…å‡½æ•°ï¼ˆå‚æ•°å°‘ï¼Œé’ˆå¯¹æŸç§åœºæ™¯ï¼‰ã€‚ä¾‹å¦‚ï¼š


```typescript
function ajax( url, data, cb ) { } // ajax å¼‚æ­¥è¯·æ±‚

let getOrder = partial(ajax, "http://some.api/order") // ç”¨äºè¯·æ±‚orderæ¥å£çš„å¼‚æ­¥å‡½æ•°

let getLastOrder = partial(getOrder, { id: ORDER_ID }) // ç”¨äºè·å–æœ€åä¸€ä¸ªorderçš„å¼‚æ­¥å‡½æ•°
let getLastOrder2 = partial(ajax, "http://some.api/order", { id: ORDER_ID }) // ç¬¬äºŒç§å®šä¹‰æ–¹æ³•
```


**åå‡½æ•°ç”¨é€”ï¼š**

- åˆ‡å‰²ä¼ å‚æ•°çš„æ—¶ç©ºèƒŒæ™¯ï¼ˆæ—¶é—´ã€ç¨‹å¼çš„ä¸åŒåŒºå—ï¼‰ï¼ŒåŸæœ¬çš„æ–¹å¼éœ€è¦åœ¨è°ƒç”¨çš„æ—¶å€™ç«‹åˆ»ä¼ å…¥æ‰€æœ‰çš„å‚æ•°ï¼Œå¦‚æœä½ çš„å‡½æ•°ä¸­æœ‰äº›å‚æ•°å¾…ä¼šæ‰ä¼ å…¥ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨**currying**å’Œ**partial application**ã€‚
- å®ç°æŸ¯é‡ŒåŒ–ï¼ˆè§ä¸‹ä¸€éƒ¨åˆ†ï¼‰
- å¯ä»¥éšè—ç»†èŠ‚ï¼Œå¢å¼ºå¯è¯»æ€§ï¼ˆä¾‹å¦‚ä¸Šé¢åŸºäºajaxçš„å°è£…ï¼‰

**å‚è€ƒæ–‡ç« ï¼š**


[bookmark](https://ithelp.ithome.com.tw/articles/10194837)


## Point-free style


**Point-free**ï¼ˆåˆå†™æˆPointfreeï¼Œä¸­æ–‡ï¼šæ— å‚æ•°ï¼Œæ— ç‚¹ï¼‰ï¼Œæ­£å¼åç§°ä¸ºï¼š**tacit programming**ï¼Œå…¶ä¸­çš„**point**ï¼ˆç‚¹ï¼‰æŒ‡çš„å°±æ˜¯å‡½æ•°çš„**parameter**ï¼ˆå½¢å¼å‚æ•°ï¼‰ã€‚


**ä½œç”¨**ï¼šPointfreeé€è¿‡éšè—**parameter** - **argument**ï¼ˆ**å½¢å‚**-**å®å‚**å¯¹åº”ï¼‰ï¼Œå‡å°‘è§†è§‰ä¸Šçš„å¹²æ‰°ï¼Œä¸Šå±‚æ“ä½œä¸ç›´æ¥æ“ä½œæ•°æ®ï¼Œåªåˆæˆè¿ç®—è¿‡ç¨‹ã€‚


ä¸¾ä¸ªä¾‹å­ï¼š


```typescript
function double(x) {
    return x * 2
}
[1,2,3,4,5].map( double ) // point free style
[1,2,3,4,5].map( v => double(v) ) // not point free style
```


## Functor å‡½å­


> **å®šä¹‰**  
> A functor is something that can be mapped over.  
> æ¥è‡ª [Haskell](https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Functor.html) å’Œ [Fantasy Land specification](https://github.com/fantasyland/fantasy-land)ã€‚


é‚£something æ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯ä¸€ç»„å€¼æ”¾åœ¨æŸä¸ªå®¹å™¨ï¼ˆé›†åˆï¼‰é‡Œï¼Œå®¹å™¨å°±æ˜¯æŒ‡è¿™äº›å€¼æ€ä¹ˆæ‘†æ”¾ï¼Œæ¯”å¦‚è¯´é˜µåˆ—ï¼ˆä¾åºåˆ—ï¼‰æˆ–è€…ç‰©ä»¶ï¼ˆç”¨key æ¥å–å€¼...ç­‰ï¼‰ã€‚


é‚£ä»€ä¹ˆå«that can be mapped overï¼Ÿä¹Ÿå°±æ˜¯jsä¸­map(..) åšçš„äº‹ï¼ŒæŠŠæ¯ä¸ªå€¼ç»è¿‡mapper(..) å¾—åˆ°æ–°å€¼ï¼Œæœ€åå†æŠŠæ–°å€¼ä¾ç…§æ”¾è¿›åŒæ ·ç»“æ„çš„å®¹å™¨åreturn ã€‚


> **JSçš„Arrayå¯¹è±¡ä¸Šï¼Œä½¿ç”¨Mapè¿˜æ˜¯forEachå‘¢ï¼Ÿ**  
> `map(..)` æ˜¯ç”¨æ¥æ˜ å°„å€¼çš„ï¼Œä¸æ˜¯æ¥äº§ç”Ÿå‰¯ä½œç”¨çš„ã€‚å¦‚æœè¦ä¼ å…¥å¸¦æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ `forEach(..)` æˆ–è€…å¹²è„†å†™ loop é¿å…é€ æˆå›°æƒ‘ã€‚


**æ€»ç»“æ¥è¯´ï¼Œä»»ä½•å…·æœ‰****`map`****æ–¹æ³•ï¼ˆæ˜ å°„å…³ç³»ï¼‰çš„èµ„æ–™ç»“æ„ï¼Œéƒ½å¯ä»¥è§†ä¸ºfunctor**ã€‚ä¾‹å¦‚ï¼š


```typescript
class Wrapper {
  constructor (value) {
    this.value = value
  }
  map (f) {
    return new Wrapper(f(this.value))
  }
}
// ä½¿ç”¨ä»£ç 
let something = new Wrapper(2) // something => { value: 2 }
let otherthing = something.map(function (value) {
  return value + 3;
}) // otherthing => { value: 5 }

```


class Wrapper å°±å¯ä»¥è§†ä½œä¸€ä¸ª functorï¼Œå› ä¸ºå®ƒå…·æœ‰mapæ–¹æ³•ã€‚è€Œä¸”åœ¨mapæ–¹æ³•ä¸­ï¼Œé€šè¿‡ä¼ å…¥çš„mapper functionï¼Œä½¿å†…éƒ¨å€¼è½¬åŒ–ï¼Œæœ€åè¿”å›æ˜ å°„åçš„æ–°å€¼ã€‚


## Continuation-passing styleï¼ˆCPSï¼‰


åœ¨JSä¸­ï¼Œcontinuationè¡¨ç¤ºå‡½æ•°ç»“æŸåä¸‹ä¸€æ­¥éª¤çš„callbackï¼Œä¹Ÿå°±æ˜¯æ¥ç€è¦åšçš„äº‹ï¼Œè€ŒCPSå°±æ˜¯åœ¨å‡½æ•°ç»“æŸåæŠŠè¦åšçš„äº‹æŒ‡å®šç»™ä¸‹ä¸€ä¸ªå‡½æ•°ï¼ˆå½“ä½œå‚æ•°ï¼‰ã€‚


**æˆ‘ç†è§£æ˜¯è¿™ç§å›è°ƒcallbacké£æ ¼å°±æ˜¯cpsã€‚**


ä»£ç å‚è€ƒï¼š


```typescript
"use strict";
var sumRecursion = (function IIFE(){
    return function sum(...nums) {
        return recursion(nums, v=>v)
    }
    function recursion([result, ...nums], cont) {
        if (nums.length == 0) return cont(result)
        return recursion( nums, function(v) {
            return cont(result + v)
        })
    }
})();
console.log(sumRecursion( 3, 1, 17, 94, 8 ));
```


å¯ä»¥å‚è€ƒï¼š


[bookmark](https://ithelp.ithome.com.tw/articles/10197332)


## å‚æ•°å¤„ç†


### è¿‡æ»¤å‚æ•°


åœºåˆï¼šå°†ä¸¤ä¸ªå‡½æ•°ç»„åˆï¼Œæ¯”å¦‚è¯´æŠŠA function ä¼ å…¥B function ï¼Œä½†æ­¤æ—¶B function ä¼ å…¥çš„å‚æ•°è·ŸA function æ•°é‡ä¸ç¬¦åˆã€‚æ¯”å¦‚è¯´ï¼š

- Bï¼šmap(...)ä¼ 3ä¸ªå˜æ•°`value`, `index`,`array`
- Aï¼šparseInt(...)æ¥æ”¶ä¸¤ä¸ªå˜æ•°`string`,`radix`

ä¾‹å¦‚ï¼š


```typescript
['1', '2'].map(parseInt)
// è¿”å›ï¼š[1, NaN]
// å› ä¸º'2'ä¼ è¿›æ¥ç›¸å½“äºæ‰§è¡Œï¼šparsetInt('2', 1)ã€‚1è¿›åˆ¶è‚¯å®šæ˜¯ä¸å¯èƒ½å‡ºç°'2'
```


å°è£…`unary`å‡½æ•°ï¼Œä»…è®©ä¸€ä¸ªå‚æ•°èƒ½é€šè¿‡ï¼š


```typescript
function unary(fn) {
    return function onlyOneArg(arg){
        return fn( arg );
    };
}
```


ä½¿ç”¨æ•ˆæœï¼š


```typescript
['1', '2'].map(unary(parseInt)) // parseintç»è¿‡åŒ…è£…åï¼Œåªä¼šæ¥æ”¶åˆ°ç¬¬1ä¸ªå‚æ•°
// è¿”å›ï¼š[1, 2]
```


### ä¼ 1è¿”1


åŸºç¡€å‡½æ•°ï¼šæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œç„¶ååŸå°ä¸åŠ¨è¿”å›


```typescript
function identical(v) {
  return v
}
```


è¿™æ ·æŸäº›åœºæ™¯ä¸‹ï¼Œå°±ä¸ç”¨å†™`() =>v` çš„è¯­æ³•ï¼Œä¾‹å¦‚ï¼š


```typescript
str.split().filter(identical) // è¿‡æ»¤ç©ºä¸²
promise1.then(identical(val)).then(func1)
```


## æ¡ä»¶åˆ¤æ–­


å–åå‡½æ•°ï¼š


```typescript
function not (testerfn) {
    return function negated (...args) {
        return !testerfn(...args)
    }
}
```


æ¡ä»¶å‡½æ•°ï¼š


```typescript
function when (testerfn, fn) {
    return function conditional (...args) {
        if (testerfn(...args)) {
            return fn(...args)
        }
    }
}
```


## å‚è€ƒæ–‡ç« 


[link_preview](https://github.com/getify/Functional-Light-JS)


[bookmark](https://ithelp.ithome.com.tw/users/20075633/ironman/1375)


[link_preview](https://github.com/front-end-class/Functional-Light-JS)


