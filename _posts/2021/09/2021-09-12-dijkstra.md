---
title: "æœ€çŸ­è·¯å¾„é—®é¢˜æ±‚è§£ä»¥åŠè¿‘ä¼¼æœ€çŸ­è·¯å¾„"
date: 2021-09-12
permalink: /2021-09-12-dijkstra/
tags: [Graph, Heap]
---

## dijkstraåº”ç”¨åœºæ™¯


æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆï¼Œä¸»è¦é’ˆå¯¹æ— æƒå›¾çš„æœç´¢ã€‚


é’ˆå¯¹æœ‰å‘æœ‰æƒå›¾ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„æ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªæƒé‡ï¼Œä½¿ç”¨çš„æ˜¯dijkstraç®—æ³•ã€‚


## dijkstraå»ºæ¨¡


### ç‚¹ï¼ˆGraphNodeï¼‰


æ³¨æ„distå±æ€§ï¼Œå®ƒæ˜¯è·ç¦»å¼€å§‹èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„è·ç¦»ã€‚


```typescript
class GraphNode {
    constructor(key) {
        this.key = key; // èŠ‚ç‚¹çš„æ ‡è¯†
        this.edges = []; // èŠ‚ç‚¹çš„è¾¹
        this.dist = 0; // è·ç¦»å¼€å§‹èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„è·ç¦»
    }
}
```


### è¾¹ï¼ˆGraphEdgeï¼‰


```typescript
class GraphEdge {
    // è¾¹ï¼šskey -> tkey
    constructor(skey, tkey, weight) {
        this.skey = skey; // è¾¹çš„å¼€å§‹èŠ‚ç‚¹
        this.tkey = tkey; // è¾¹çš„ç»“æŸèŠ‚ç‚¹
        this.weight = weight; // è¾¹çš„æƒé‡
    }
}
```


### å›¾ï¼ˆGraphï¼‰


```typescript
class Graph {
    constructor() {
        this.nodes = {}; // å›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹
    }
    /**
     * æ–°å¢ä¸€æ¡è¾¹ï¼šskey -> tkey
     * @param {string} skey å¼€å§‹èŠ‚ç‚¹æ ‡è¯†
     * @param {string} tkey ç»“æŸèŠ‚ç‚¹æ ‡è¯†
     * @param {number} w è¾¹çš„æƒé‡
     */
    addEdge(skey, tkey, w) {
        this.nodes[skey].edges.push(new GraphEdge(skey, tkey, w));
    }
}
```


### æœ€å°å †


è¿™é‡Œçš„æœ€å°å †ä¸»è¦ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå®ƒèƒ½åœ¨O(1) æ—¶é—´å†…ï¼Œå¿«é€Ÿå¾—åˆ°å½“å‰è·ç¦»æºç‚¹æœ€è¿‘çš„èŠ‚ç‚¹ã€‚


å †ä½¿ç”¨`heap.js`å®ç°ï¼š


```typescript
const { Heap } = require("heap-js");
class DistPriorityQueue {
    constructor() {
        this.minHeap = new Heap(this.heapComparator);
    }
    // å°é¡¶å †ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿè®¡ç®—ç›®å‰å“ªä¸ªæœªè¢«è®¿é—®çš„ã€è·ç¦»å¼€å§‹èŠ‚ç‚¹æœ€è¿‘çš„èŠ‚ç‚¹
    heapComparator(a, b) {
        return a.dist - b.dist;
    }
}

```


## dijkstraç®—æ³•å®ç°


![Untitled.png](https://raw.githubusercontent.com/dongyuanxin/static/main/blog/imgs/2021-09-12-dijkstra/3a93cd3673481a2114acfa23b5d21a00.png)


### å®ç°æ€è·¯


è¿™é‡Œç®€å•è®°å½•å¤§ä½“çš„æ€è·¯ï¼Œå…·ä½“å¯è§ä¸Šå›¾ã€‚


åˆå§‹åŒ–æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œé™¤äº†å¼€å§‹èŠ‚ç‚¹æœ¬èº«distè®¾ç½®ä¸º0ï¼Œå…¶ä»–èŠ‚ç‚¹çš„distå‡ä¸ºæœ€å¤§å€¼ï¼ˆæ–¹ä¾¿ä¹‹åæ¯”è¾ƒï¼‰ã€‚åŒæ—¶å°†å¼€å§‹èŠ‚ç‚¹å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚


ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­**å–å‡º**è·ç¦»å¼€å§‹èŠ‚ç‚¹æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œæ£€æŸ¥æ­¤èŠ‚ç‚¹æ˜¯å¦æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè¯´æ˜å·²ç»åˆ°è¾¾ç›®çš„åœ°ï¼Œæ­¤æ—¶ä¸ºæœ€çŸ­è·ç¦»ï¼Œç»“æŸç®—æ³•ã€‚


å¦åˆ™ï¼Œå¼€å§‹å°è¯•å¾€ä¸‹ç»§ç»­èµ°ï¼Œè®¿é—®æ­¤èŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹ï¼š

- å½“å‰èŠ‚ç‚¹çš„dist +é‚»è¾¹é•¿åº¦ < é‚»è¾¹èŠ‚ç‚¹çš„distï¼Œé‚£ä¹ˆè¯´æ˜ä»å½“å‰èŠ‚ç‚¹è¿‡æ¥è·ç¦»æ›´çŸ­ï¼Œæ›´æ–°é‚»è¾¹èŠ‚ç‚¹çš„distå€¼ã€‚

	å¦‚æœé˜Ÿåˆ—ä¸­å­˜åœ¨é‚»å±…èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±æ›´æ–°updateï¼ˆå…¶å®å°±æ˜¯æ›´æ–°èŠ‚ç‚¹çš„distä¹‹åï¼Œå¯¹å †é‡æ–°æ’åºï¼‰ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å°†å…¶æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚

- å½“å‰èŠ‚ç‚¹çš„dist +é‚»è¾¹é•¿åº¦ â‰¥ é‚»è¾¹èŠ‚ç‚¹çš„distï¼Œé‚£ä¹ˆè¯´æ˜è¿™æ¡è·¯æ›´é•¿ï¼Œæ²¡æœ‰å¿…è¦èµ°ï¼Œä¸åšä»»ä½•å¤„ç†ã€‚

ä¸€ç›´æŒç»­ï¼Œç›´åˆ°èµ°åˆ°ç›®çš„èŠ‚ç‚¹ã€‚


> **ğŸŒŸğŸŒŸğŸŒŸä¼˜å…ˆé˜Ÿåˆ—çš„ä½œç”¨**  
> èƒ½å¤Ÿå¿«é€Ÿæ‹¿åˆ°ç›®å‰è·ç¦»å¼€å§‹èŠ‚ç‚¹æœ€è¿‘çš„èŠ‚ç‚¹ï¼ˆå †é¡¶å…ƒç´ ï¼‰ï¼Œä»è€Œæ¯æ¬¡éƒ½ä»æœ€è¿‘çš„èŠ‚ç‚¹å‡ºå‘ï¼Œä¸€æ­¥æ­¥éå†åˆ°ç›®çš„èŠ‚ç‚¹ã€‚


### å®ç°ä»£ç 


```typescript
/**
 * @param {Graph} graph å›¾
 * @param {string} skey å¼€å§‹èŠ‚ç‚¹çš„æ ‡è¯†
 * @param {string} tkey ç»“æŸèŠ‚ç‚¹çš„æ ‡è¯†
 */
function dijkstra(graph, skey, tkey) {
    // step0: ç”¨æ¥ä¿å­˜æœ€çŸ­è·¯å¾„ï¼Œç”¨äºè¾“å‡ºæ‰“å°
    //      keyå’Œvalueä»£è¡¨è·¯å¾„æ–¹å‘ï¼Œä»valueèµ°åˆ°keyï¼škey <- value
    const pathNodes = {};

    // step1: åˆå§‹åŒ–æ¯ä¸ªèŠ‚ç‚¹è·ç¦»å¼€å§‹èŠ‚ç‚¹çš„è·ç¦»ï¼ˆdistå±æ€§ï¼‰
    //      é™¤äº†è‡ªå·±è®¾ç½®ä¸º0ï¼Œå…¶å®ƒéƒ½æ˜¯æœ€å¤§å€¼
    for (const key in graph.nodes) {
        const node = graph.nodes[key];
        node.dist = key === skey ? 0 : Number.MAX_VALUE;
    }

    // step2: ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå°é¡¶å †ï¼‰ï¼Œç”¨äºå–å‡ºdistå±æ€§æœ€å°çš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯è·ç¦»å¼€å§‹èŠ‚ç‚¹æœ€è¿‘çš„ç‚¹
    const queue = new DistPriorityQueue();
    queue.minHeap.push(graph.nodes[skey]);

    // step3: é˜²æ­¢åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¢«å¤šæ¬¡æ·»åŠ åˆ°queueä¸­ï¼ˆç¯ï¼‰ï¼Œé€ æˆæ— é™å¾ªç¯
    const visited = {};
    visited[skey] = true;

    // step4: æ¯æ¬¡éƒ½å–å‡ºæœªéå†åˆ°çš„ï¼Œæœ€è¿‘çš„ç‚¹
    //        ç„¶åéå†æœ€è¿‘çš„ç‚¹çš„é‚»å±…èŠ‚ç‚¹
    //        å¦‚æœé‚»å±…èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶ï¼ˆå…·ä½“çœ‹å†…å¾ªç¯ï¼‰ï¼Œåˆ™å¢åŠ åˆ°queueä¸­
    while (queue.minHeap.size()) {
        // æ¯æ¬¡æ‹¿åˆ°çš„éƒ½æ˜¯è·ç¦»å¼€å§‹èŠ‚ç‚¹æœ€è¿‘çš„ç‚¹
        // æœ€å°å †å¯ä»¥ä¿è¯åœ¨O(logN)å†…æ‹¿åˆ°
        const minDistNode = queue.minHeap.pop();
        // åˆ°è¾¾ç›®çš„åœ°
        if (minDistNode.key === tkey) {
            break;
        }
        for (const edge of minDistNode.edges) {
            const linkedNode = graph.nodes[edge.tkey];
            // å½“å‰è·ç¦»å¼€å§‹èŠ‚ç‚¹æœ€è¿‘çš„ç‚¹ï¼Œç»§ç»­å¾€é‚»å±…èŠ‚ç‚¹â€œèµ°â€
            // å¦‚æœè·ç¦»+èµ°çš„è·ç¦»ï¼Œæ¯”é‚»å±…èŠ‚ç‚¹åˆ°å¼€å§‹èŠ‚ç‚¹è·ç¦»è¿˜å°çš„è¯
            // é‚£ä¹ˆæ›´æ–°é‚»å±…èŠ‚ç‚¹çš„distå±æ€§ï¼Œæ›´æ–°pathNodesï¼Œå¹¶ä¸”æ›´æ–°queue
            if (minDistNode.dist + edge.weight < linkedNode.dist) {
                linkedNode.dist = minDistNode.dist + edge.weight;
                pathNodes[linkedNode.key] = minDistNode.key;

                if (visited[linkedNode.key]) {
                    queue.minHeap.remove(linkedNode);
                    queue.minHeap.push(linkedNode);
                } else {
                    queue.minHeap.push(linkedNode);
                    visited[linkedNode.key] = true;
                }
            }
        }
    }
    console.log(">>> è·¯å¾„æ˜¯", pathNodes);
}
```


### æµ‹è¯•ä»£ç 


```typescript
// æµ‹è¯•ä»£ç 
const a = new GraphNode("a");
const b = new GraphNode("b");
const c = new GraphNode("c");
const d = new GraphNode("d");
const e = new GraphNode("e");

const graph = new Graph();
graph.nodes = {
    a,
    b,
    c,
    d,
    e,
};
graph.addEdge("a", "b", 3);
graph.addEdge("a", "c", 1);
graph.addEdge("b", "e", 2);
graph.addEdge("c", "d", 1);
graph.addEdge("d", "e", 2);
// è¾“å‡ºï¼š>>> è·¯å¾„æ˜¯ { b: 'a', c: 'a', d: 'c', e: 'd' }
// é€†åºæ’åˆ—ä¸‹å°±æ˜¯è·¯å¾„é¡ºåºäº†ï¼še <- d <- c <- a
dijkstra(graph, "a", "e");
```


## å®é™…åœ°å›¾é¡¹ç›®-è¿‘ä¼¼æœ€çŸ­è·¯å¾„


### å®é™…å·¥ç¨‹åº”ç”¨ä¸­çš„å–èˆ


å¯¹äºå®é™…åœ°å›¾ï¼Œè€ƒè™‘å…¨éƒ¨çš„ç‚¹å’Œè¾¹å›ºç„¶å¯ä»¥å¾—åˆ°æœ€æœ‰è§£ï¼Œä½†æ˜¯è®¡ç®—å¤æ‚åº¦é«˜`O(E*logV)`


**ä¸€èˆ¬åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œåªè¦å–ä¸ªè¿‘ä¼¼è§£å³å¯ã€‚**


### å¦‚ä½•å–è¿‘ä¼¼è§£ï¼Ÿ


æˆ‘ä»¬å‘ç°ï¼Œæœ€ä¼˜è·¯å¾„ä¸€èˆ¬åœ¨ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è¿çº¿ï¼Œä¸ä¼šå‘â€œå¤–â€ç»•ã€‚


åˆ†2ç§æƒ…å†µï¼š

- ä¸¤ä¸ªç‚¹è·ç¦»æ¯”è¾ƒè¿‘ï¼ˆæ¯”å¦‚5å…¬é‡Œï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®2ä¸ªç‚¹åšç›´çº¿ï¼Œå¹¶ä¸”ç‚¹æ˜¯ç›´çº¿ä¸­ç‚¹ã€‚
ç„¶åå‹¾å‡ºä¸€ä¸ªçŸ©å½¢ï¼Œæ ¹æ®è§„å¾‹åªè€ƒè™‘çŸ©å½¢å†…çš„è·¯å¾„å’Œç‚¹å³å¯
- ä¸¤ä¸ªç‚¹è·ç¦»æ¯”è¾ƒè¿œï¼ˆæ¯”å¦‚500å…¬é‡Œï¼‰ï¼Œé‚£ä¹ˆæŒ‰ç…§æ–¹æ³•1ï¼Œä¹Ÿä¼šæœ‰å¾ˆå¤šçš„è·¯å¾„å’Œç‚¹ã€‚
æ­¤æ—¶ï¼Œåªè€ƒè™‘å›½é“ã€çœé“ç­‰ä¸»å¹²é“å³å¯ã€‚
ç±»ä¼¼é«˜å¾·åœ°å›¾ï¼Œå½“åœ°å›¾ç¼©å°åˆ°ä¸€å®šæ¯”ä¾‹ï¼Œæ— å…³ç´§è¦çš„ç‚¹å’Œè·¯å¾„ï¼Œéƒ½ä¸å†æ˜¾ç¤ºã€‚å½“è¡Œé©¶è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€åŠ è½½è®¡ç®—é™„è¿‘çš„è·¯å¾„å’Œç‚¹å³å¯ï¼ˆè¯¦ç»†åœ°ï¼‰ã€‚

**è¿™ä¸¤ç§å¤„ç†æ€è·¯çš„ä¸»æ—¨æ˜¯å¿½ç•¥ä¸€äº›ä¸é‡è¦çš„è·¯å¾„å’Œç‚¹ã€‚**


### å‚è€ƒ


æå®¢æ—¶é—´-æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾


