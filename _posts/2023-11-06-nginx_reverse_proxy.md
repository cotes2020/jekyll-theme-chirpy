---
title: Nginxì™€ reverse proxy # íŒŒì¼ ëª…ì€ ì˜ì–´ë§Œ ì¨ì•¼í•˜ì§€ë§Œ, ì—¬ê¸°ëŠ” í•œê¸€ì´ ê°€ëŠ¥
author: smpringles24 # \_data/authors.yml ì— ìˆëŠ” author id (ì—¬ëŸ¬ëª…ì¸ê²½ìš° authors: [id1, id2, ...])
date: 2023-11-06 20:00:00 +0900 # +0900ì€ í•œêµ­ì˜ íƒ€ì„ì¡´  (ë‚ ì§œê°€ ë¯¸ë˜ì¸ê²½ìš° ë¹Œë“œì‹œ ìŠ¤í‚µí•¨.)
categories: [network, nginx] # ì¹´í…Œê³ ë¦¬ëŠ” ë©”ì¸, ì„œë¸Œ 2ê°œë§Œ ì„¤ì • ê°€ëŠ¥ (ë„ì–´ì“°ê¸° ê°€ëŠ¥)
tags: [nginx, reverse proxy, newtwork, apache] # íƒœê·¸ëŠ” ê°œìˆ˜ì œí•œ X (ë„ì–´ì“°ê¸° ê°€ëŠ¥)
# toc: true # Table Of ContentëŠ” ê¸°ë³¸ì ìœ¼ë¡œ trueë¡œ ë˜ì–´ìˆìŒ.
# comments: true # ê¸°ë³¸ì ìœ¼ë¡œ true
# pin: false # ê¸€ ê³ ì • ì—¬ë¶€ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ false, ê³µì§€ ê°™ì€ê²Œ ì•„ë‹ˆë¼ë©´ ê·¸ëŒ€ë¡œ ë‘ê¸°
# math: false # ì„±ëŠ¥ ë¬¸ì œë¡œ ê¸°ë³¸ì ìœ¼ë¡œ falseë¡œ ë˜ì–´ìˆìŒ. ìˆ˜ì‹ì„ ì ëŠ”ë‹¤ë©´ trueë¡œ ë°”ê¿€ ê²ƒ
# mermaid: false # ë‹¤ì´ì–´ê·¸ë¨ íˆ´ë¡œì¨ ì„±ëŠ¥ ë¬¸ì œë¡œ ê¸°ë³¸ì ìœ¼ë¡œ flaseë¡œ ë˜ì–´ìˆìŒ.  https://mermaid.js.org/intro/
render_with_liquid: false
---

# ğŸ¤”ë°œí‘œ ì£¼ì œì„ ì •

êµ°ëŒ€ ê°œë°œ ë°œí‘œ ì†Œëª¨ì„ Vivacheì˜ ì²«ë²ˆì§¸ ë°œí‘œë¡œ ë‚´ìš©ì„ ì°¾ë˜ ë„ì¤‘, ìëŒ€ì— ì²˜ìŒ ì™€ì„œ ê°œë°œì„ í•˜ê¸° ìœ„í•´ êµ¬ì¶•í–ˆë˜ ê°œë°œ í™˜ê²½ ì„¸íŒ…ì´ ë– ì˜¬ëë‹¤. ìëŒ€ì— ì²˜ìŒ ì™”ì„ ë‹¹ì‹œ, ì‚¬ì§€ë°©ì—ì„œ ì›í•˜ëŠ” í¼í¬ë¨¼ìŠ¤ë¡œ ê°œë°œì„ í•˜ê¸°ì—ëŠ” ì—¬ëŸ¬ ë¶ˆí¸ì‚¬í•­ë“¤ì´ ìˆì—ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ íŒŒì¼ ë‹¤ìš´ë¡œë“œë„ ììœ ë¡­ì§€ ëª»í•˜ê³ , ë¸Œë¼ìš°ì € ì ‘ì†ë„ http/httpsì´ì™¸ì˜ í”„ë¡œí† ì½œì´ ì œí•œë˜ëŠ” ë“±ì˜ ë¬¸ì œê°€ ìˆì—ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì§‘ì— NAS ì„œë²„ë¥¼ ë“¤ì´ê³ , í™ˆ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì¶•í•˜ê³  ì•„íŒŒì¹˜ ê³¼ì¹´ëª°ë¦¬ë¼ëŠ” ì‹œìŠ¤í…œìœ¼ë¡œ ì§‘ì— ìˆëŠ” pcì— ì›ê²©ì ‘ì†ì„ ì‹œë„í–ˆê³  ê²°ê³¼ì ìœ¼ë¡œ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ê°œë°œ í™˜ê²½ì„ ê°–ì¶œ ìˆ˜ ìˆì—ˆë‹¤.

ì´ë•Œ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ê³µë¶€í•˜ê³ , íŠ¹íˆ ip, DNS, DDNS, Reverse Proxyê°™ì€ ê°œë…ì„ ìŠµë“í–ˆì—ˆëŠ”ë°, ëŒ€ëµ 6ê°œì›” ì •ë„ê°€ ì§€ë‚œ ì§€ê¸ˆ, ê·¸ ë‹¹ì‹œì— ìµíŒ ì§€ì‹ë“¤ì„ ì •ë¦¬, ë³´ì™„í•˜ì—¬ ë°œí‘œë¥¼ í•´ë³´ë ¤ê³  í•œë‹¤. 

# ğŸ““1.1. Apache web server

1998ë…„ ê°„ë‹¨í•œ ì›¹ ì„œë²„ ë°°í¬ë¥¼ ìœ„í•´ apache web serverë¼ëŠ” íˆ´ì´ ê³µê°œë˜ì—ˆë‹¤. apache web serverëŠ” 'ëª¨ë“ˆ'ì´ë¼ëŠ” ê°œë…ì„ ì ìš©í•˜ì—¬ íƒ€ì‚¬ì˜ DBMS, ì—¬ëŸ¬ í”„ë¡œí† ì½œ ë“±ì„ íˆ´ì— ì ìš©í•  ìˆ˜ ìˆê²Œ í•˜ì˜€ë‹¤. ì´ëŠ” í™•ì¥ì„±ì„ í¬ê²Œ ë„“í˜€ì£¼ì—ˆê³ , apache web serverì˜ ì‚¬ìš©ìëŠ” ì ì  ëŠ˜ì–´ë‚¬ë‹¤.

ê·¸ëŸ°ë° 2000ë…„ëŒ€ë¥¼ ì§€ë‚˜ë©´ì„œ ì„œì„œíˆ ì¼ë°˜ ê°€ì •ì—ë„ ì»´í“¨í„°ì™€ íœ´ëŒ€ì „í™”ê°€ ë³´ê¸‰ë˜ê¸° ì‹œì‘í•˜ë©´ì„œ apache web serverì— ë¬¸ì œê°€ ìƒê¸°ê¸° ì‹œì‘í•œë‹¤. apache web serverëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ 1ëŒ€1ë¡œ connectë¥¼ ë§ºê³  ì‘ë‹µì„ ì£¼ê³ ë°›ê¸° ë•Œë¬¸ì— clientìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ ê·¸ëŒ€ë¡œ ì„œë²„ìª½ì˜ ë¶€ë‹´ì´ ì¦ê°€í•˜ê²Œ ëœë‹¤. ì´ ë¬¸ì œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ì ˆëŒ€ì ì¸ ìˆ˜ê°€ ì¦ê°€í•¨ì— ë”°ë¼ ì ì  ê±°ë¡ ë˜ê¸° ì‹œì‘í–ˆê³  ì´ëŠ” 1ë§Œê°œì˜ connectionì„ ì²˜ë¦¬í•´ë‚¼ ìˆ˜ ì—†ë‹¤ëŠ” ì˜ë¯¸ì˜  C10K(connection 10000 problem) ë¬¸ì œë¡œ ë‚¨ì•˜ë‹¤.


# ğŸ““1.2. Nginxì˜ ë“±ì¥

2004ë…„, apache web serverì˜ C10Kë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ëŒ€í•œìœ¼ë¡œ Nginxë¼ëŠ” íˆ´ì´ ë“±ì¥í–ˆë‹¤. NginxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ apache web serverì™€ í•¨ê»˜ ë™ì‘í•˜ê³  apache web serverë¡œ ê°€ì•¼ í•  í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ Nginxì—ì„œ 1ì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤. ì¦‰ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ Nginxê°€ ë¨¼ì € ë°›ì•„ ì •ì  í˜ì´ì§€ ì²˜ë¦¬, ìºì‹œ ë°ì´í„° ë°˜í™˜ ë“±ì˜ ê°„ë‹¨í•œ ì²˜ë¦¬ë¥¼ ì‹œë„í•˜ê³  ë™ì  í˜ì´ì§€ ì²˜ë¦¬ ë“±ì˜ ë³µì¡í•œ ì—…ë¬´ë§Œ apache web serverì— ìš”ì²­í•˜ëŠ” í˜•íƒœì´ë‹¤.

# ğŸ““1.3. Apache web server ì™€ Nginxì˜ ì‘ë™ ë°©ì‹

apache web serverì—ëŠ” 10,000ê°œ ìƒë‹¹ì˜ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ê°ë‹¹í•  ìˆ˜ ì—†ëŠ” C10Kë¬¸ì œê°€ ìˆì—ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ Nginxì—ë„ 10,000ê°œ ìƒë‹¹ì˜ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´ ë¬¸ì œê°€ ë˜ì§€ëŠ” ì•Šì„ê¹Œ? 2000ë…„ëŒ€ ì´ˆë°˜ì— ë¹„í•´ ì¸í„°ë„· ì‚¬ìš©ìëŠ” ìˆ˜ì‹­ ìˆ˜ë°±ë°° ì¦ê°€í–ˆì„í…ë°, ì–´ë–»ê²Œ NginxëŠ” ì•„ì§ê¹Œì§€ ì‚¬ìš©ë  ìˆ˜ ìˆì„ê¹Œ? ê·¸ ë‹µì€ Nginxì™€ apache web serverì˜ ê·¼ë³¸ì ì¸ ë™ì‘ ë°©ì‹ì˜ ì°¨ì´ì— ìˆë‹¤.

### Apache web server

![apache_work_flow](/assets/img/2023-11-06-nginx_reverse_proxy/apache_work_flow.png)
apche web serverì—ì„œëŠ” ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì— connectionì„ í˜•ì„±í•œë‹¤. ì´ë•Œ ìƒì„±ëœ processë“¤ì€ cpuì˜ ê° ì½”ì–´ì— í• ë‹¹ë˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ ì½”ì–´ í•˜ë‚˜ì—ì„œ ì—¬ëŸ¬ê°œì˜ processë¥¼ ì±…ì„ì§€ê²Œ ëœë‹¤.

### Nginx

![nginx_work_flow](/assets/img/2023-11-06-nginx_reverse_proxy/nginx_work_flow.png)
nginxëŠ” master processì™€ worker processë¡œ êµ¬ì„±ëœë‹¤. master processëŠ” worker processë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ë˜ë©° cpuì˜ ê° coreë‹¹ ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ì»¤ë‹¤ë€ worker processê°€ ì‹¤í–‰ë˜ê³ , ê°  worker processëŠ”  ë¹„ë™ê¸° ì´ë²¤íŠ¸ê¸°ë°˜ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìˆ˜ì˜ í…ŒìŠ¤í¬ë¥¼ í ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.



nginxì˜ ë™ì‘ êµ¬ì¡°ìƒ ì–»ì„ ìˆ˜ ìˆëŠ” ì´ë“ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- cpuì—ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì²˜ë¦¬í•  ë•Œ, í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ê³  ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‘ì—… ì˜ì—­ì— ì˜¬ë¦¬ëŠ” ì‹œê°„ì´ ë°œìƒí•˜ëŠ”ë° (context switch) ì´ëŸ¬í•œ ë¹„ìš©ì´ ë“¤ì§€ ì•ŠëŠ”ë‹¤.
- í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì˜ ìˆ˜ì— ë¹„ë¡€í•´ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ì´ ì¦ê°€í•˜ëŠ” apache web serverì— ë¹„í•´ nginxëŠ” ì‹¤í–‰ë˜ëŠ” worker processì˜ ìˆ˜ê°€ ì •í•´ì ¸ ìˆê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì´ ë¹„êµì  ì¼ì •í•˜ê²Œ ìœ ì§€ëœë‹¤.




ì´ì™¸ì—ë„ nginxì—ì„œëŠ” ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ì—¬ëŸ¬ ë‹¤ë¥¸ ê°œë…ì´ ì ìš©ë˜ì–´ìˆë‹¤.

**I/O Non-Blocking :** ë¹„êµì  ì‹œê°„ì´ ì˜¤ë˜ ì†Œìš”ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ I/O ì‘ì—…ì´ í•„ìš”í•  ë•Œ, worker processê°€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë‹¤ë¥¸ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ë°©ì‹

**ì“°ë ˆë“œ í’€(Nginx 1.7.11ë¶€í„° ì ìš©) :** ì‹œê°„ì´ ë§ì´ ê±¸ë¦¬ëŠ” íŠ¹ìˆ˜í•œ ì‘ì—…ë“¤ì„ ë³„ë„ì˜ ì“°ë ˆë“œ í’€ì—ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬




# ğŸ““2. í”„ë¡ì‹œ, ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ
### í”„ë¡ì‹œ (Proxy)

![proxy](/assets/img/2023-11-06-nginx_reverse_proxy/proxy.png)

í”„ë¡ì‹œ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ì‚¬ì´ì— ìœ„ì¹˜í•˜ë©° í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì„œë²„ì— ëŒ€ì‹  ì „ë‹¬í•œë‹¤.

í”„ë¡ì‹œì˜ ì¥ì 
- **ìµëª…ì„± ë³´ì¥:** í´ë¼ì´ì–¸íŠ¸ì˜ ì‹¤ì œ IP ì£¼ì†Œë¥¼ ìˆ¨ê¸°ê³  í”„ë¡ì‹œ ì„œë²„ì˜ IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸í„°ë„·ì„ íƒìƒ‰
- **ì½˜í…ì¸  í•„í„°ë§:** ì›¹ íŠ¸ë˜í”½ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  íŠ¹ì • ì‚¬ì´íŠ¸ë‚˜ ì½˜í…ì¸ ì— ëŒ€í•œ ì ‘ê·¼ì„ ì°¨ë‹¨
- **ìºì‹±:** ìì£¼ ìš”ì²­ë˜ëŠ” ì½˜í…ì¸ ë¥¼ í”„ë¡ì‹œ ì„œë²„ì— ì €ì¥í•´ë‘” ë’¤, ì„œë²„ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë°”ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µì„ ì£¼ì–´ ì„±ëŠ¥ì„ í–¥ìƒ


### ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ (Reverse Proxy)

![reverse_proxy](/assets/img/2023-11-06-nginx_reverse_proxy/reverse_proxy.png)

ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œëŠ” ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ì— ìœ„ì¹˜í•˜ë©°, ì£¼ë¡œ ì„œë²„ ì¸¡ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ ì„œë²„ë¡œ ì „ë‹¬í•œë‹¤.

ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œì˜ ì¥ì 
- **ë³´ì•ˆ ê°•í™”:** ì›ë³¸ ì„œë²„ì˜ ì‹¤ì œ IP ì£¼ì†Œë¥¼ ìˆ¨ê¸°ê³ , ì™¸ë¶€ ê³µê²©ìœ¼ë¡œë¶€í„° ë³´í˜¸
- **ë¶€í•˜ ë¶„ì‚°:** ì—¬ëŸ¬ ì„œë²„ë¡œ íŠ¸ë˜í”½ì„ ë¶„ì‚°ì‹œì¼œ ì„œë²„ ë¶€í•˜ë¥¼ ì¤„ì´ê³  ì„œë¹„ìŠ¤ì˜ ê°€ìš©ì„±ì„ í–¥ìƒ
- **ìºì‹± ë° ì••ì¶•:** ìì£¼ ìš”ì²­ë˜ëŠ” ì½˜í…ì¸ ë¥¼ í”„ë¡ì‹œ ì„œë²„ì— ì €ì¥í•˜ì—¬ ë¹ ë¥´ê²Œ ì œê³µí•˜ê³ , ë°ì´í„°ë¥¼ ì••ì¶•í•˜ì—¬ ì „ì†¡ íš¨ìœ¨ì„ ë†’ì„
- **SSL ì•”í˜¸í™”:** í´ë¼ì´ì–¸íŠ¸ì™€ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì‚¬ì´ì˜ í†µì‹ ì„ ì•”í˜¸í™”í•˜ì—¬ ë³´ì•ˆì„ ê°•í™”
   
   
   
# ğŸ’»êµ¬í˜„

ê·¸ë ‡ë‹¤ë©´ nginxì—ì„œ reverse proxyë¥¼ êµ¬í˜„í•´ë³´ì.

#### 1. nginx ì„¤ì¹˜ (ubuntu ê¸°ì¤€)

`$ sudo apt install nginx`

#### 2. nginx ì‹¤í–‰

- nginx ì‹¤í–‰
`$ sudo systemctl start nginx`

- ì‹œìŠ¤í…œ ì¬ë¶€íŒ…ì‹œ nginx ìë™ì‹¤í–‰
`$ sudo systemctl enable nginx`

#### 3. nginx íŒŒì¼ êµ¬ì„± ì‚´í´ë³´ê¸°

![nginx_file](/assets/img/2023-11-06-nginx_reverse_proxy/nginx_file.png)

![nginx_file2](/assets/img/2023-11-06-nginx_reverse_proxy/nginx_file2.png)

ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” íŒŒì¼/í´ë”ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
nginx.conf : nginxì˜ ë©”ì¸ configíŒŒì¼. sites-enabledë‚´ì˜ íŒŒì¼ë“¤ì„ ì°¸ì¡°í•˜ì—¬ ë¡œë“œí•œë‹¤.
sites enabled : sites availableì— ë§Œë“  configíŒŒì¼ ì¤‘ í™œì„±í™”í•  íŒŒì¼ë“¤ì„ ì‹¬ë³¼ë¦­ ë§í¬í•´ì˜¨ë‹¤.
sites available : nginxì˜ ì„œë¸Œ configíŒŒì¼ì„ ì €ì¥í•´ë‘” ë””ë ‰í† ë¦¬. í™œì„±í™”ë˜ì§€ ì•Šì€ ìƒíƒœ.

#### 4. nginx.conf íŒŒì¼ ìˆ˜ì •

ìš°ì„  ê°„ë‹¨í•œ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

```
server{
	listen 8888;
	server_name localhost;

	location /post {
		alias /home/smpringles;
		index main.html;
	}
}
```
localhostì˜ 8888ë²ˆ í¬íŠ¸ '/post' ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†ì„ í•˜ë©´ -> ì„œë²„ì¸¡ pcì˜ /home/smpringles/main.html íŒŒì¼ì„ ë³´ì—¬ì¤€ë‹¤.



ê·¸ í›„, ë‹¤ë¥¸ í¬íŠ¸ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“  ë’¤, `proxy_pass`ë¡œ ìš”ì²­ì„ ë¦¬ë‹¤ì´ë ‰ì…˜ í•´ì¤€ë‹¤.

```
server{
	listen 9999;
	server_name localhost;

	location / {
		proxy_pass http://localhost:8888;
	}
}
```
