---
title: "ES6é‡éš¾ç‚¹æ•´ç†"
date: 2019-04-09
permalink: /2019-04-09/
---

ğŸ‘‡ å†…å®¹é€Ÿè§ˆ ğŸ‘‡

- let å’Œ const
- Set å’Œ Map
- Generator å’Œ yield
- Promiseã€async/await ä»‹ç»
- Proxy ä»£ç†å™¨
- ...

### let å’Œ const

ES6 æ–°å¢äº†`let`å’Œ`const`ï¼Œå®ƒä»¬å£°æ˜çš„å˜é‡ï¼Œéƒ½å¤„äºâ€œå—çº§ä½œç”¨åŸŸâ€ã€‚å¹¶ä¸”ä¸å­˜åœ¨â€œå˜é‡æå‡â€ï¼Œä¸å…è®¸é‡å¤å£°æ˜ã€‚

åŒæ—¶ï¼Œ`const`å£°æ˜çš„å˜é‡æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¿å­˜çš„æ•°æ®ä¸å¾—æ”¹å˜ï¼š

- å¯¹äºç®€å•ç±»å‹çš„æ•°æ®ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œå€¼å°±ä¿å­˜åœ¨å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ï¼Œå› æ­¤ç­‰åŒäºå¸¸é‡ã€‚
- å¯¹äºå¤åˆç±»å‹çš„æ•°æ®ï¼ˆä¸»è¦æ˜¯å¯¹è±¡å’Œæ•°ç»„ï¼‰ï¼Œå˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œä¿å­˜çš„åªæ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆï¼Œ`const`åªèƒ½ä¿è¯è¿™ä¸ªæŒ‡é’ˆæ˜¯å›ºå®šçš„ï¼ˆå³æ€»æ˜¯æŒ‡å‘å¦ä¸€ä¸ªå›ºå®šçš„åœ°å€ï¼‰ï¼Œä¸èƒ½ä¿è¯æŒ‡å‘çš„æ•°æ®ç»“æ„ä¸å¯å˜ã€‚

å¦‚æœè¦ä¿è¯æŒ‡å‘çš„æ•°æ®ç»“æ„ä¹Ÿä¸å¯å˜ï¼Œéœ€è¦è‡ªè¡Œå°è£…ï¼š

```javascript
/**
 * å†»ç»“å¯¹è±¡
 * @param {Object} obj
 * @return {Object}
 */
function constantize(obj) {
  if (Object.isFrozen(obj)) {
    return obj;
  }

  Reflect.ownKeys(obj).forEach(key => {
    // å¦‚æœå±æ€§æ˜¯å¯¹è±¡ï¼Œé€’å½’å†»ç»“
    typeof obj[key] === "object" && (obj[key] = constantize(obj[key]));
  });

  return Object.freeze(obj);
}

/********æµ‹è¯•ä»£ç  **********/

const obj = {
  a: 1,
  b: {
    c: 2,
    d: {
      a: 1
    }
  },
  d: [1, 2]
};

const fronzenObj = constantize(obj);
try {
  fronzenObj.d = [];
  fronzenObj.b.c = 3;
} catch (error) {
  console.log(error.message);
}
```

### Set å’Œ Map

> é¢˜ç›®ï¼šè§£é‡Šä¸‹`Set`å’Œ`Map`ã€‚

- Set å…ƒç´ ä¸å…è®¸é‡å¤
- Map ç±»ä¼¼å¯¹è±¡ï¼Œä½†æ˜¯å®ƒçš„é”®ï¼ˆkeyï¼‰å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹

**â‘ Set å¸¸ç”¨æ–¹æ³•**

```javascript
// å®ä¾‹åŒ–ä¸€ä¸ªset
const set = new Set([1, 2, 3, 4]);

// éå†set
for (let item of set) {
  console.log(item);
}

// æ·»åŠ å…ƒç´ ï¼Œè¿”å›Setæœ¬èº«
set.add(5).add(6);

// Setå¤§å°
console.log(set.size);

// æ£€æŸ¥å…ƒç´ å­˜åœ¨
console.log(set.has(0));

// åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œè¿”å›bool
let success = set.delete(1);
console.log(success);

set.clear();
```

å…¶ä»–éå†æ–¹æ³•ï¼šç”±äºæ²¡æœ‰é”®åï¼Œ`values()`å’Œ`keys()`è¿”å›åŒæ ·ç»“æœã€‚

```javascript
for (let item of set.keys()) {
  console.log(item);
}

for (let item of set.values()) {
  console.log(item);
}

for (let item of set.entries()) {
  console.log(item);
}
```

**â‘¡Map å¸¸ç”¨æ–¹æ³•**

Map æ¥å£åŸºæœ¬å’Œ Set ä¸€è‡´ã€‚ä¸åŒçš„æ˜¯å¢åŠ æ–°å…ƒç´ çš„ API æ˜¯ï¼š`set(key, value)`

```javascript
const map = new Map();

// ä»¥ä»»æ„å¯¹è±¡ä¸º Key å€¼
// è¿™é‡Œä»¥ Date å¯¹è±¡ä¸ºä¾‹
let key = new Date();
map.set(key, "today");

console.log(map.get(key));
```

### Generator ä¸ yield

`generator`å‡½æ•°æ˜¯ es6 æä¾›çš„æ–°ç‰¹æ€§ï¼Œå®ƒçš„æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼š**æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ**ã€‚è®©æˆ‘ä»¬ä»ç½‘ä¸Šæœ€ç«çš„ä¸€ä¸ªä¾‹å­æ¥çœ‹ï¼š

```javascript
function* foo(x) {
  var y = 2 * (yield x + 1);
  var z = yield y / 3;
  return x + y + z;
}

var b = foo(5);
b.next(); // { value:6, done:false }
b.next(12); // { value:8, done:false }
b.next(13); // { value:42, done:true }
```

é€šä¿—çš„è§£é‡Šä¸‹ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§è¾“å‡ºï¼š

1. ç»™å‡½æ•° foo ä¼ å…¥å‚æ•° 5ï¼Œä½†ç”±äºå®ƒæ˜¯ generatorï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°**ç¬¬ä¸€ä¸ª yield å‰**å°±åœæ­¢äº†ã€‚
1. ç¬¬ä¸€æ¬¡è°ƒç”¨ next()ï¼Œ**è¿™æ¬¡ä¼ å…¥çš„å‚æ•°ä¼šè¢«å¿½ç•¥**æš‚åœ\*\*ã€‚
1. ç¬¬äºŒæ¬¡è°ƒç”¨ next(12)ï¼Œ**ä¼ å…¥çš„å‚æ•°ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ª yield è¡¨è¾¾å¼çš„è¿”å›å€¼**ã€‚å› æ­¤ï¼Œy = 2 \* 12 = 24ã€‚æ‰§è¡Œåˆ°ç¬¬äºŒä¸ª yieldï¼Œè¿”å›å…¶åçš„è¡¨è¾¾å¼çš„å€¼ 24 / 3 = 8ã€‚ç„¶åå‡½æ•°åœ¨æ­¤å¤„æš‚åœã€‚
1. ç¬¬ä¸‰æ¬¡è°ƒç”¨ next(13)ï¼Œæ²¡æœ‰ yieldï¼Œåªå‰© return äº†ï¼ŒæŒ‰ç…§æ­£å¸¸å‡½æ•°é‚£æ ·è¿”å› return çš„è¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶ä¸”`done`ä¸º`true`ã€‚

**éš¾ç‚¹**ï¼šåœ¨äºä¸ºä»€ä¹ˆæœ€åçš„`value`æ˜¯ 42 å‘¢ï¼Ÿ

é¦–å…ˆï¼Œ`x`çš„å€¼æ˜¯åˆšå¼€å§‹è°ƒç”¨ foo å‡½æ•°ä¼ å…¥çš„ 5ã€‚è€Œæœ€åä¼ å…¥çš„ 13 è¢«å½“ä½œç¬¬äºŒä¸ª yield çš„è¿”å›å€¼ï¼Œæ‰€ä»¥`z`çš„å€¼æ˜¯ 13ã€‚å¯¹äº`y`çš„å€¼ï¼Œæˆ‘ä»¬åœ¨å‰é¢ç¬¬ä¸‰æ­¥ä¸­å·²ç»è®¡ç®—å‡ºæ¥äº†ï¼Œå°±æ˜¯ 24ã€‚

æ‰€ä»¥ï¼Œ`x + y + z = 5 + 24 + 13 = 42`

çœ‹æ‡‚äº†ä¸Šé¢çš„åˆ†æï¼Œå†çœ‹ä¸‹é¢è¿™æ®µä»£ç å°±å¾ˆå¥½ç†è§£äº†ï¼š

```javascript
function* foo(x) {
  var y = 2 * (yield x + 1);
  var z = yield y / 3;
  return x + y + z;
}

var a = foo(5);
a.next(); // Object{value:6, done:false}
a.next(); // Object{value:NaN, done:false}
a.next(); // Object{value:NaN, done:true}
```

åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ next å‡½æ•°çš„æ—¶å€™ï¼Œè¾“å‡ºçš„ value æ˜¯ 6ã€‚å…¶ä»–æ—¶å€™ç”±äºæ²¡æœ‰ç»™ next ä¼ å…¥å‚æ•°ï¼Œå› æ­¤ yield çš„è¿”å›å€¼éƒ½æ˜¯`undefined`ï¼Œè¿›è¡Œè¿ç®—åè‡ªç„¶æ˜¯`NaN`ã€‚

### Promise ä»‹ç»

ç®€å•å½’çº³ä¸‹ Promiseï¼š**ä¸‰ä¸ªçŠ¶æ€ã€ä¸¤ä¸ªè¿‡ç¨‹ã€ä¸€ä¸ªæ–¹æ³•**

- ä¸‰ä¸ªçŠ¶æ€ï¼š`pending`ã€`fulfilled`ã€`rejected`
- ä¸¤ä¸ªè¿‡ç¨‹ï¼ˆ**å•å‘ä¸å¯é€†**ï¼‰ï¼š
  - `pending`->`fulfilled`
  - `pending`->`rejected`
- ä¸€ä¸ªæ–¹æ³•`then`ï¼š`Promise`æœ¬è´¨ä¸Šåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œ`catch`å’Œ`all`æ–¹æ³•éƒ½æ˜¯åŸºäº`then`æ–¹æ³•å®ç°çš„ã€‚

è¯·çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```javascript
// æ„é€  Promise æ—¶å€™, å†…éƒ¨å‡½æ•°ç«‹å³æ‰§è¡Œ
new Promise((resolve, reject) => {
  console.log("new Promise");
  resolve("success");
});
console.log("finifsh");

//  then ä¸­ ä½¿ç”¨äº† returnï¼Œé‚£ä¹ˆ return çš„å€¼ä¼šè¢« Promise.resolve() åŒ…è£…
Promise.resolve(1)
  .then(res => {
    console.log(res); // => 1
    return 2; // åŒ…è£…æˆ Promise.resolve(2)
  })
  .then(res => {
    console.log(res); // => 2
  });
```

### async/await ä»‹ç»

`async`å‡½æ•°è¿”å›ä¸€ä¸ª`Promise`å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨`then`æ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚

å½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ°`await`å°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ã€‚

è¿™ä¹Ÿæ˜¯å®ƒæœ€å—æ¬¢è¿çš„åœ°æ–¹ï¼š**èƒ½è®©å¼‚æ­¥ä»£ç å†™èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œå¹¶ä¸”æ–¹ä¾¿æ§åˆ¶é¡ºåº**ã€‚

å¯ä»¥åˆ©ç”¨å®ƒå®ç°ä¸€ä¸ª`sleep`å‡½æ•°é˜»å¡è¿›ç¨‹ï¼š

```javascript
function sleep(millisecond) {
  return new Promise(resolve => {
    setTimeout(() => resolve, millisecond);
  });
}

/**
 * ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
 */
async function test() {
  console.log("start");
  await sleep(1000); // ç¡çœ 1ç§’
  console.log("end");
}

test(); // æ‰§è¡Œæµ‹è¯•å‡½æ•°
```

è™½ç„¶æ–¹ä¾¿ï¼Œ**ä½†æ˜¯å®ƒä¹Ÿä¸èƒ½å–ä»£`Promise`ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨`Promise.all()`æ¥å®ç°å¹¶å‘**ï¼Œè€Œ`async/await`åªèƒ½å®ç°ä¸²è¡Œã€‚

```javascript
function sleep(second) {
  return new Promise(resolve => {
    setTimeout(() => {
      console.log(Math.random());
      resolve();
    }, second);
  });
}

async function chuanXingDemo() {
  await sleep(1000);
  await sleep(1000);
  await sleep(1000);
}

async function bingXingDemo() {
  var tasks = [];
  for (let i = 0; i < 3; ++i) {
    tasks.push(sleep(1000));
  }

  await Promise.all(tasks);
}
```

è¿è¡Œ`bingXingDemo()`ï¼Œå‡ ä¹åŒæ—¶è¾“å‡ºï¼Œå®ƒæ˜¯å¹¶å‘æ‰§è¡Œï¼›è¿è¡Œ`chuanXingDemo()`ï¼Œæ¯ä¸ªè¾“å‡ºé—´éš” 1sï¼Œå®ƒæ˜¯ä¸²è¡Œæ‰§è¡Œã€‚

### ES6 å¯¹è±¡å’Œ ES5 å¯¹è±¡

> é¢˜ç›®ï¼šes6 class çš„ new å®ä¾‹å’Œ es5 çš„ new å®ä¾‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

åœ¨`ES6`ä¸­ï¼ˆå’Œ`ES5`ç›¸æ¯”ï¼‰ï¼Œ`class`çš„`new`å®ä¾‹æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- `class`çš„æ„é€ å‚æ•°å¿…é¡»æ˜¯`new`æ¥è°ƒç”¨ï¼Œä¸å¯ä»¥å°†å…¶ä½œä¸ºæ™®é€šå‡½æ•°æ‰§è¡Œ
- `es6` çš„`class`ä¸å­˜åœ¨å˜é‡æå‡
- **æœ€é‡è¦çš„æ˜¯ï¼šes6 å†…éƒ¨æ–¹æ³•ä¸å¯ä»¥æšä¸¾**ã€‚es5 çš„`prototype`ä¸Šçš„æ–¹æ³•å¯ä»¥æšä¸¾ã€‚

ä¸ºæ­¤æˆ‘åšäº†ä»¥ä¸‹æµ‹è¯•ä»£ç è¿›è¡ŒéªŒè¯ï¼š

```javascript
console.log(ES5Class()); // es5:å¯ä»¥ç›´æ¥ä½œä¸ºå‡½æ•°è¿è¡Œ
// console.log(new ES6Class()) // ä¼šæŠ¥é”™ï¼šä¸å­˜åœ¨å˜é‡æå‡

function ES5Class() {
  console.log("hello");
}

ES5Class.prototype.func = function() {
  console.log("Hello world");
};

class ES6Class {
  constructor() {}
  func() {
    console.log("Hello world");
  }
}

let es5 = new ES5Class();
let es6 = new ES6Class();

// æ¨èåœ¨å¾ªç¯å¯¹è±¡å±æ€§çš„æ—¶å€™ï¼Œä½¿ç”¨for...in
// åœ¨éå†æ•°ç»„çš„æ—¶å€™çš„æ—¶å€™ï¼Œä½¿ç”¨for...of
console.log("ES5 :");
for (let _ in es5) {
  console.log(_);
}

// es6:ä¸å¯æšä¸¾
console.log("ES6 :");
for (let _ in es6) {
  console.log(_);
}
```

**å‚è€ƒ/æ¨è**ï¼š[ã€ŠJavaScript åˆ›å»ºå¯¹è±¡â€”ä» es5 åˆ° es6ã€‹](https://fed.renren.com/2017/08/07/js-oop-es52es6/)

### Proxy ä»£ç†å™¨

ä»–å¯ä»¥å®ç° js ä¸­çš„â€œå…ƒç¼–ç¨‹â€ï¼šåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾æ‹¦æˆªï¼Œå¯ä»¥è¿‡æ»¤å’Œä¿®æ”¹å¤–éƒ¨çš„è®¿é—®ã€‚

å®ƒæ”¯æŒå¤šè¾¾ 13 ç§æ‹¦æˆªæ“ä½œï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç å±•ç¤ºçš„`set`å’Œ`get`æ–¹æ³•ï¼Œåˆ†åˆ«å¯ä»¥åœ¨è®¾ç½®å¯¹è±¡å±æ€§å’Œè®¿é—®å¯¹è±¡å±æ€§æ—¶å€™è¿›è¡Œæ‹¦æˆªã€‚

```javascript
const handler = {
  // receiver æŒ‡å‘ proxy å®ä¾‹
  get(target, property, receiver) {
    console.log(`GET: target is ${target}, property is ${property}`);
    return Reflect.get(target, property, receiver);
  },
  set(target, property, value, receiver) {
    console.log(`SET: target is ${target}, property is ${property}`);
    return Reflect.set(target, property, value);
  }
};

const obj = { a: 1, b: { c: 0, d: { e: -1 } } };
const newObj = new Proxy(obj, handler);

/**
 * ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
 */

newObj.a; // output: GET...
newObj.b.c; // output: GET...

newObj.a = 123; // output: SET...
newObj.b.c = -1; // output: GET...
```

è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šå‘ç°æœ€åä¸€è¡Œçš„è¾“å‡ºæ˜¯ `GET ...`ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒè§¦å‘çš„æ˜¯`get`æ‹¦æˆªå™¨ï¼Œè€Œä¸æ˜¯æœŸæœ›çš„`set`æ‹¦æˆªå™¨ã€‚**è¿™æ˜¯å› ä¸ºå¯¹äºå¯¹è±¡çš„æ·±å±‚å±æ€§ï¼Œéœ€è¦ä¸“é—¨å¯¹å…¶è®¾ç½® Proxy**ã€‚

**æ›´å¤šè¯·è§**ï¼š[ã€Šé˜®ä¸€å³° ES6 å…¥é—¨ï¼šProxyã€‹](http://es6.ruanyifeng.com/#docs/proxy)

### EsModule å’Œ CommonJS çš„æ¯”è¾ƒ

ç›®å‰ js ç¤¾åŒºæœ‰ 4 ç§æ¨¡å—ç®¡ç†è§„èŒƒï¼šAMDã€CMDã€CommonJS å’Œ EsModuleã€‚ ES Module æ˜¯åŸç”Ÿå®ç°çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œä¸ CommonJS æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«ï¼š

- CommonJS æ”¯æŒåŠ¨æ€å¯¼å…¥ï¼Œä¹Ÿå°±æ˜¯ `require(${path}/xx.js)`ï¼Œåè€…ç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯å·²æœ‰ææ¡ˆï¼š`import(xxx)`
- CommonJS æ˜¯åŒæ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæœåŠ¡ç«¯ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³ä½¿å¡ä½ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœä¹Ÿé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰å¾ˆå¤§å½±å“
- commonJs è¾“å‡ºçš„æ˜¯å€¼çš„æµ…æ‹·è´ï¼ŒesModule è¾“å‡ºå€¼çš„å¼•ç”¨
- ES Module ä¼šç¼–è¯‘æˆ `require/exports` æ¥æ‰§è¡Œçš„
