---
title: What's new in RxSwift6(1)
date: 2021-1-10 10:43:59 +0800
author: grohong
categories: [RxSwift]
tags: [RxSwift6, Swift5]
image: /assets/RxSwift/RxSwift6Logo.png
---

2021ë…„ [RxSwift6](https://github.com/ReactiveX/RxSwift/releases/tag/6.0.0)ê°€ ìƒˆë¡œìš´ ë¡œê³ ì™€ í•¨ê»˜ ë¦´ë¦¬ì¦ˆ ëìŠµë‹ˆë‹¤. ğŸš€ğŸš€\\
ë³€ê²½ì‚¬í•­ì— ëŒ€í•´ì„œëŠ” [í•´ë‹¹ í¬ìŠ¤íŒ…](https://dev.to/freak4pc/what-s-new-in-rxswift-6-2nog#new-logo)ì—ì„œ ì‚´í´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê°ê°ì˜ ë³€ê²½ì‚¬í•­ì´ ì–´ë–»ê²Œ êµ¬í˜„ëëŠ”ì§€ ì•Œì•„ë³´ê³ , ì–´ë–»ê²Œ ì“°ì¼ì§€ ì •ë¦¬í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!


# **Swift5**

RxSwift6ì—ì„œëŠ” Swift5ì—ì„œ ìƒˆë¡­ê²Œ ì—…ë°ì´íŠ¸ ëœ ë‚´ìš©ì´ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ ```KeyPayh```ì™€ ```@dynamicMemberLookup```ë¥¼ ì´ìš©í•œ property ì ‘ê·¼ìœ¼ë¡œ ë°©ì‹ê³¼ ```@functionBuilder```ê°€ ë„ì…ë˜ì—ˆê³ , ```Result``` typeì´ ì¶”ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë²ˆ ì¥ì—ì„œëŠ” RxSwift6ì— ì–´ë–»ê²Œ Swift5ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ì§€ ë´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<br>

## **dynamicMemberLookupì„ ì‚¬ìš©í•œÂ Binderì˜ ìë™ í•©ì„±** ğŸŒŸ

ì´ë²ˆ RxSwift6ì—ì„œ í•˜ì´ë¼ì´íŠ¸ë¼ê³  ìƒê°ë˜ëŠ” ë³€ê²½ì‚¬í•­ì…ë‹ˆë‹¤!\\
RxSwift5ì—ì„œëŠ” íŠ¹ì • ê°ì²´ í”„ë¡œí¼í‹°ì— ```.rx```ë¥¼ ì´ìš©í•˜ì—¬ **Binding**ì„ í•˜ì—¬ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ”, **Reactive extension** ì´ìš©í•˜ì—¬ êµ¬í˜„í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```swift
class MyView: UIView { 
    var title: String
    var subtitle: String?
    var icon: UIImage?
}

// implement Reactive extension
extension Reactive where Base: MyView {
    var title: Binder<String> {
       Binder(base) { base, title in 
           base.title = title
       }
    }

    var subtitle: Binder<String?> {
       Binder(base) { base, subtitle in 
           base.subtitle = subtitle
       }
    }

    var icon: Binder<UIImage?> {
       Binder(base) { base, icon in 
           base.icon = icon
       }
}

// bind view
viewModel.title.bind(to: myView.rx.title)
viewModel.subtitle.bind(to: myView.rx.subtitle)
viewModel.icon.drive(myView.rx.icon)
```

ì´ì²˜ëŸ¼ viewë¥¼ ë§Œë“¤ë•Œë§ˆë‹¤ **Reactive extension**ì„ êµ¬í˜„í•´ì£¼ëŠ” ì¼ì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì´ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ RxSwift6ì—ì„œëŠ” Swift5ì˜ ```@dynamicMemberLookup```ë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ **Reactive extension**ì„ êµ¬í˜„í•´ ì£¼ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

![```@dynamicMemberLookup```](/assets/RxSwift/ReactiveExtension.jpg)

ìœ„ ì‚¬ì§„ ì²˜ëŸ¼ RxSwift6ì—ì„œëŠ” ë”°ë¡œ ì‘ì—…ì„ í•˜ì§€ ì•Šì•„ë„ ë°”ë¡œ ```.rx```ë¡œ **Binder**ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ‘

```@dynamicMemberLookup```ì€ Swift4.2ì—ì„œ ì²˜ìŒìœ¼ë¡œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤. **class**ë‚˜ **struct**ì—ì„œ propertyë¥¼ ì¡´ì¬ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ```subscript```ë¡œ ì ‘ê·¼ê°€ëŠ¥ í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Swift5.1ì—ì„œëŠ” ```KeyPath```ë¥¼ ì´ìš©í•´ propertyì„ ë©í•‘í•˜ì—¬ ì ‘ê·¼ê°€ëŠ¥ í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ([Key Path Member Lookup](https://github.com/apple/swift-evolution/blob/master/proposals/0252-keypath-dynamic-member-lookup.md))

RxSwift5ì˜ ```Reactive```ë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ```Base```ë§Œ Genericìœ¼ë¡œ ë°›ê³ , ë‚˜ë¨¸ì§€ëŠ” extensionìœ¼ë¡œ Bindingì„ êµ¬í˜„í•˜ë„ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤..

```swift
// RxSwift5
public struct Reactive<Base> {
     /// Base object to extend.
    public let base: Base

    /// Creates extensions with base object.
    ///
    /// - parameter base: Base object.
    public init(_ base: Base) {
        self.base = base
    }
}
```

í•˜ì§€ë§Œ RxSwift6ì—ì„œëŠ” ```@dynamicMemberLookup```ì„ ì´ìš©í•´ ```Reactive```ë¥¼ êµ¬í˜„í•˜ì—¬ ë”°ë¡œ extensionìœ¼ë¡œ ì‘ì—…í•˜ì§€ ì•Šë”ë¼ë„, ```KeyPath```ë¥¼ ì´ìš©í•˜ì—¬ viewì˜ propertyì— Bindingì„ í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ¤

```swift
// RxSwift6
@dynamicMemberLookup
public struct Reactive<Base: AnyObject> {
    /// Base object to extend.
    public let base: Base

    /// Creates extensions with base object.
    ///
    /// - parameter base: Base object.
    public init(_ base: Base) {
        self.base = base
    }

    public subscript<Property>(dynamicMember keyPath: ReferenceWritableKeyPath<Base, Property>) -> AnyObserver<Property> {
        return AnyObserver { [weak base] event in
            guard let base = base,
                  case .next(let value) = event else { return }

            base[keyPath: keyPath] = value
        }
    }
}
```


ì´ë¥¼ ì´ìš©í•˜ì—¬ RxSwift6ì—ì„œëŠ” **Reactive extension**ì„ ì´ìš©í•´ ê°ê°ì˜ viewì—ì„œ êµ¬í˜„í•´ì¤˜ì•¼ í•  ë°˜ë³µì ì¸ ì‘ì—…ì„ ```KeyPath```ë¥¼ ì´ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br>

## **DisposeBag í•¨ìˆ˜ ë¹Œë” ì¶”ê°€ ğŸ—**

RxSwift6ì—ì„¸ëŠ” ```DisposableBuilder```ë¥¼ êµ¬í˜„í•˜ì—¬ **Builder íŒ¨í„´**ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ RxSwift5ì—ì„œëŠ” ê°ê°ì˜ **bind**ë§ˆì§€ë§‰ì— ```DisposeBag```ì„ ì§€ì •í•´ì£¼ë˜ê±¸ ```DisposableBuilder```ë¥¼ ì´ìš©í•´ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
// RxSwift5
let disposeBag = DisposeBag()
observable1.bind(to: input1).disposed(by: disposeBag)

observable2.drive(input2).disposed(by: disposeBag)

observable3
    .subscribe(onNext: { val in 
        print("Got \(val)")
    })
    .disposed(by: disposeBag)

// RxSwift6
var disposeBag = DisposeBag { 
    observable1.bind(to: input1)

    observable2.drive(input2)

    observable3.subscribe(onNext: { val in 
        print("Got \(val)")
    })
}
```

**Builder íŒ¨í„´**ì„ ì‚¬ìš©í•˜ë©´ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ”(ìœ„ ì½”ë“œì—ì„œëŠ” .disposed(by: disposeBag)) ì½”ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆê³ , ```disposeBag```ì´ ì‚¬ìš©ë˜ëŠ” ì½”ë“œë¥¼ ëª¨ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

RxSwift6ì—ì„œëŠ” Swift5.1ì—ì„œ ì†Œê°œëœ ```@_functionBuilder```ë¥¼ ì‚¬ìš©í•˜ì—¬ **Builder íŒ¨í„´**ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. RxSwift6ì˜ ì½”ë“œë¥¼ ë´ë³´ê² ìŠµë‹ˆë‹¤.

```swift
/// A function builder accepting a list of Disposables and returning them as an array.
@_functionBuilder
public struct DisposableBuilder {
    public static func buildBlock(_ disposables: Disposable...) -> [Disposable] {
        return disposables
    }
}
```

ìš°ì„  ì½”ë“œì—ì„œëŠ” ```@_functionBuilder```ë¥¼ ì´ìš©í•˜ì—¬ ```buildBlock```ì„ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆëŠ” ```DisposableBuilder```ì„ êµ¬í˜„í•´ ì¤ë‹ˆë‹¤.

```swift
extension DisposeBag {
    /// Convenience init which utilizes a function builder to let you pass in a list of
    /// disposables to make a DisposeBag of.
    public convenience init(@DisposableBuilder builder: () -> [Disposable]) {
      self.init(disposing: builder())
    }
}
```

```swift
/// Convenience init which utilizes a function builder to let you pass in a list of
/// disposables to make a DisposeBag of.
public convenience init(@DisposableBuilder builder: () -> [Disposable]) {
    self.init(disposing: builder())
}
```
ê·¸ í›„ ```DisposableBuilder```ì„ ì´ìš©í•˜ì—¬ ```DispoaseBag init```ì„ êµ¬í˜„í•´ ì¤ë‹ˆë‹¤. ì´ë ‡ê²Œ ```DispoaseBag```ì— **builder block**ì„ ì ìš©í•  ìˆ˜ ìˆëŠ” **struct**ì„ ```@_functionBuilder``` ì´ìš©í•´ ë§Œë“¤ì–´ ```init``` ì ìš©í•´ ì£¼ë©´, ê°„ë‹¨í•˜ê²Œ **Builder íŒ¨í„´**ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

## **Singleì˜ êµ¬í˜„ì„ Swiftì˜ Resultë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½**

RxSwiftì—ì„œ [Singleê°ì²´](https://github.com/ReactiveX/RxSwift/blob/main/Documentation/Traits.md#single)ëŠ” <ins>**elements** ì™€ **error**ë§Œ ë°©ì¶œí•˜ëŠ” Observable ê°ì²´</ins>ì…ë‹ˆë‹¤.

RxSwift5ì—ì„œëŠ” Singleê°ì²´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ **elements** ì™€ **error**ë¥¼ í‘œí˜„í•  typeì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ```SingleEvent```ë¼ëŠ” enumìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
// RxSwift5

public enum SingleEvent<Element> {
    /// One and only sequence element is produced. (underlying observable sequence emits: `.next(Element)`, `.completed`)
    case success(Element)

    /// Sequence terminated with an error. (underlying observable sequence emits: `.error(Error)`)
    case error(Swift.Error)
}
```

í•˜ì§€ë§Œ Swift5ì—ì„œ ```Result```ë¼ëŠ” ìƒˆë¡œìš´ typeì´ ì†Œê°œ ë˜ì—ˆìŠµë‹ˆë‹¤. Result typeì€ **success** ì™€ **failure** ì¼€ì´ìŠ¤ê°€ ìˆëŠ” enumìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ìœ„ì˜ ```SingleEvent```ì™€ ë˜‘ê°™ì€ í˜•íƒœì´ê¸° ë•Œë¬¸ì— RxSwift6ì—ì„œëŠ” ```SingleEvent```ë¥¼ ```Result```ë¡œ ```typealias``` í•˜ì—¬ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
// RxSwift6

public typealias SingleEvent<Element> = Result<Element, Swift.Error>
```

<br>

## **distinctUntilChange(at:)ì—°ì‚°ìì—ì„œ Key Path ì§€ì›**

**Swift5.2**ì—ì„œë¶€í„° Keypath typeì„ ì´ìš©í•´ closureì˜ í‘œí˜„ì„ ê°„ë‹¨í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\\
RxSwift6ì—ì„œë„ ```distinctUntilChange(at:)```ì—°ì‚°ìì—ì„œ Keypathë¥¼ ì§€ì›í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
// RxSwift5
myStream.distinctUntilChanged { $0.searchTerm == $1.searchTerm }

// RxSwift6
myStream.distinctUntilChanged(at: \.searchTerm)
```

ì´ëŠ” RxSwfit6ì—ì„œ **element**ì— ```KeyPath```ë¥¼ ì´ìš©í•˜ì—¬ propertyì— ì ‘ê·¼í•˜ë„ë¡ êµ¬í˜„ ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
public func distinctUntilChanged<Property: Equatable>(at keyPath: KeyPath<Element, Property>) -> Observable<Element> {
    self.distinctUntilChanged { $0[keyPath: keyPath] == $1[keyPath: keyPath] }
}
```