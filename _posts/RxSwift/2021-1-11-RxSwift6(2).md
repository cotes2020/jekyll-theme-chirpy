---
title: What's new in RxSwift6(2)
date: 2021-1-20 10:43:59 +0800
author: grohong
categories: [RxSwift]
tags: [RxSwift6]
image: /assets/RxSwift/RxSwift6Logo.png
---

ì• í¬ìŠ¤íŒ…ì—ì„œëŠ” Swift5ê°€ RxSwift6ì— ì–´ë–»ê²Œ ì ìš©ë˜ì—ˆëŠ”ì§€ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” RxSwift6ì— ìƒˆë¡­ê²Œ ì¶”ê°€ëœ **Observable type** ê³¼ **Operationì„** ì•Œì•„ë³´ê³ , ì‚¬ìš©ì„±ì„ ì–´ë–»ê²Œ ê°œì…˜ ë˜ì—ˆëŠ”ì§€ ì‚´í´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤! ğŸ‘€

## **Infallible**

```Infallible```ì€ RxSwift6ì—ì„œ ìƒˆë¡­ê²Œ ì¶”ê°€ëœ **Observable type**ì…ë‹ˆë‹¤. ```Observable```ê³¼ ë‹¤ë¥´ê²Œ ```.error```ë¥¼ ë°©ì¶œ(emit)í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” ```RxCocoa```ì˜ **Relay**ì™€ ë¹„ìŠ·í•œ ê°œë…(relayì—ì„œëŠ” ```.completed``` ì™€ ```.error```ë¥¼ ë°©ì¶œ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)ìœ¼ë¡œ ```.error```ë¡œ ì¸í•´ **subscribe**ê°€ ì¢…ë£Œë˜ëŠ” ê²ƒì„ ë°©ì§€í• ë•Œ ìœ ìš©í•˜ê²Œ ì“°ì¼ê±° ê°™ìŠµë‹ˆë‹¤.

```swift
Infallible<String>.create { observer in
    observer(.next("Hello"))
    observer(.next("World"))
    observer(.completed)
    // ì—¬ê¸°ì—ì„œ .errorë¥¼ ë°©ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

    return Disposables.create {
        // Clean-up
    }
}
```

ë¬¼ë¡  ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ í•˜ëŠ” ```Driver```ì™€ ```Signal```ì´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë‘˜ì€ RxCocoaì— <ins>UIì‘ì—…ì„ ìœ„í•´</ins> ```Observable``` ì´ìš©í•´ ```MainScheduler```ì—ì„œ ì‘ì—…ì´ ë˜ë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ```Infallible```ì€ ì™„ì „íˆ ìƒˆë¡œìš´ ```Observable type``` ì´ë¼ëŠ” ì ì—ì„œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤! ğŸ†•

<br>

## **ReplayRelay ì—°ì‚°ì ì¶”ê°€**

RxSwift6ì—ì„œëŠ” ```ReplayRelay```ì™€ ```PublishRelay```ì—ì„œ ```ReplayRelay```ë¥¼ ì¶”ê°€í•˜ì—¬ 3ê°€ì§€ì˜ **Relay**ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **Relay**ì—ì„œëŠ” ```.completed``` ì™€ ```.error```ë¥¼ ë°©ì¶œ í•˜ì§€ ì•Šì•„, ```.error``` ì™€ ```.completed```ë¡œ ì¸í•œ **subscribe**ê°€ ì¢…ë£Œë˜ëŠ” ê²ƒì„ ë°©ì§€ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ë²•ì€ ```ReplaySubject``` ì™€ ë™ì¼í•©ë‹ˆë‹¤.

```swift
// Subject
ReplaySubject<Int>.create(bufferSize: 3)

// Relay
ReplayRelay<Int>.create(bufferSize: 3)
```

<br>

## **withUnretainedÂ ì¶”ê°€** ğŸŒŸ

RxSwiftë¡œ êµ¬í˜„ëœ **ViewModel**ë¥¼ **stream**ì„ **View**ì— **Binding**í•˜ê¸° ìœ„í•´ì„œëŠ” ```self```ì— ëŒ€í•œ ì°¸ê³ ë¥¼ **capture lists**ë¥¼ í†µí•´ ë°›ìŠµë‹ˆë‹¤. ì´ì™€ ê°™ì€ ì‘ì—…ì€ ë§¤ë²ˆ **Binding**ì„ í• ë•Œë§ˆë‹¤ ë°˜ë³µì ìœ¼ë¡œ ì‘ì—…ì„ í•´ì¤˜ì•¼ í–ˆìŠµë‹ˆë‹¤.

```swift
viewModel.importantInfo
    .subscribe(onNext: { [weak self] info in 
        guard let self = self else { return }
        self.doImportantTask(with: info)
    })
    .disposed(on: disposeBag)
```

ì´ëŸ¬í•œ ë°˜ë³µì„ ë©ˆì¶”ë„ë¡ ```withUnretained``` operation
ì´ ì¶”ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!ğŸ‘ ```withUnretained``` operationì„ í†µí•´ ë¯¸ë¦¬ ```self```ë¥¼ ì°¸ì¡° ë°›ì•„ **capture lists** ì—†ì§€ ì‘ì—…ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
viewModel.importantInfo
  .withUnretained(self) // (Object, Element) ë“€í”Œ ë°˜í™˜
  .subscribe(onNext: { owner, info in 
    owner.doImportantTask(with: info)
  })
  .disposed(by: disposeBag)
```

ì´ì œëŠ” ë§ì€ ì˜ˆì œì˜ ```bindViewmodel()``` í•¨ìˆ˜ì— ```output```ì— ë¯¸ë¦¬ ```self``` ì°¸ì¡°ë¥¼ ë°›ì•„ì„œ ì‚¬ìš©í•  ê²ƒ ê°™ë„¤ìš”.

```swift
func bindViewModel() {
    ...
    let output = viewModel.output.withUnretained(self)

    // viewì™€ bind ì‘ì—…
    ...
}
```

<br>

## **Observable<Data>ë¥¼ ìœ„í•œÂ decode(type:decoder:)ì—°ì‚°ì ì œê³µ**

Swiftì˜ [Codable](https://developer.apple.com/documentation/swift/codable)ì„ ì´ìš©í•˜ì—¬ data decodeë¥¼ í•˜ëŠ” **Operation**ì¸ ```decode(type:decoder:)``` ì¶”ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
service.rx
    .fetchJSONUsers() // Observable<Data> ë°˜í™˜
    .decode(type: [User].self, decoder: JSONDecoder()) // Observable<[User]> ë°˜í™˜
```

í•´ë‹¹ **Operation**ì˜ ì¶”ê°€ë¡œ Rxë¥¼ ì´ìš©í•œ ë„¤íŠ¸ì›Œí¬ ë¼ì´ë¸ŒëŸ¬ë“¤ì˜ **decode** operationì´ ë³€ê²½ë êº¼ ê°™ìŠµë‹ˆë‹¤. ì˜ˆë¡œ [RxMoya](https://github.com/Moya/Moya)ëŠ” ì•„ë˜ì™€ ê°™ì´ **decode** í•¨ìˆ˜ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.([In History](https://github.com/Moya/Moya/commit/0658ce1bcfaccba82bb20ac4135baeb4c282bb84#diff-6a382b0b0cf529cce3d1b54eaac6ef0b620cb796045e4546799b99ff0a221659))

```swift
/// Maps received data at key path into a Decodable object. If the conversion fails, the signal errors.
func map<D: Decodable>(_ type: D.Type, atKeyPath keyPath: String? = nil, using decoder: JSONDecoder = JSONDecoder(), failsOnEmptyData: Bool = true) -> Single<D> {
    return flatMap { .just(try $0.map(type, atKeyPath: keyPath, using: decoder, failsOnEmptyData: failsOnEmptyData)) }
}
```

<br>

## **driver(),Â emit()ì— ë‹¤ì¤‘ ë°”ì¸ë”© ì œê³µ**

RxSwift6ì—ì„œ ```Driver```ì™€ ```Signal```ì—ì„œë„ multi Bindingì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ë¡œì¸í•´ RxSwif5ì—ì„œëŠ” ê°ê°ì˜ viewì— ```subscribe```ë¥¼ í•´ì£¼ë˜ ì‘ì—…ì„ í•œë²ˆì— í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
// RxSwift5
viewModel.string.drive(input1)
viewModel.string.drive(input2)
viewModel.string.drive(input3)

viewModel.number.emit(input4)
viewModel.number.emit(input5)

// RxSwift6
viewModel.string.drive(input1, input2, input3)
viewModel.number.emit(input4, input5)
```

ì´ëŠ” Swiftì— ```Variadic Parameters```ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ```Variadic Parameters```ëŠ” íŒŒë¼ë¯¸í„°ë¡œ íŠ¹ì • ê°ì²´ë¥¼ í•œê°œ ì´ìƒ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

RxSwift5ì—ì„œëŠ” ```Drive``` í•œê°œì˜ ```Observer``` ê°ì²´ë§Œ ë°›ì•„ì„œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

```swift
// RxSwift5
public func drive<Observer: ObserverType>(_ observer: Observer) -> Disposable where Observer.Element == Element {  
    MainScheduler.ensureRunningOnMainThread(errorMessage: errorMessage)
    return self.asSharedSequence().asObservable().subscribe(observer)
}
```

RxSwift6ì—ì„œëŠ” **(1)** ```Variadic Parameters``` ì´ìš©í•˜ì—¬ í•œê°œ ì´ìƒì˜ ```Observer``` ê°ì²´ë§Œ ë°›ì•„ì„œ **(2)** ê°ê°ì˜ ```Observer```ì— **element**ë¥¼ ë„˜ê²¨ì£¼ë„ë¡ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
// RxSwift5
// (1) Variadic Parametersë¥¼ ì‚¬ìš©í•˜ì—¬ í•œê°œ ì´ìƒì˜ Observerì„ ë°›ìŒ
public func drive<Observer: ObserverType>(_ observers: Observer...) -> Disposable where Observer.Element == Element {
    MainScheduler.ensureRunningOnMainThread(errorMessage: errorMessage)
    return self.asSharedSequence()
                    .asObservable()
                    .map { $0 as Element? }
                    .subscribe { e in
                        // (2) ê°ê°ì˜ Observerì— element ë„˜ê²¨ì¤Œ
                        observers.forEach { $0.on(e) }
                    }
}
```

<br>

## **Binderê°€ RxCocoaì—ì„œ RxSwiftë¡œ ì´ë™**

```Binder```ëŠ” **input**, **outputì„** ê°„ë‹¨íˆ **Binding**í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ë§Œì•½ ```Binder```ê°€ ì—†ë‹¤ë©´ **output**ì„ ```subscribe```ë°›ë„ë¡ ì„¤ì •í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```swift
// RxSwift5
// not use Binder
viewModel.isButtonEnable
    .subscribe(onNext: { [weak self] in self?.myButton.isEnabled = $0 })
    .disposed(by: disposeBag)

// RxSwift6
// use Binder
viewModel.isButtonEnable
    .bind(to: myButton.rx.isEnabled)
    .disposed(by: disposeBag)
```

í•˜ì§€ë§Œ ì´ë²ˆ RxSwift6ì—ì„œëŠ” RxCocoaì— ìˆëŠ” ```Binding```ì´ ë„˜ì–´ì˜¤ë©´ì„œ, ê°„ë‹¨í•œ ```bind```ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ RxCocoaë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ì–´ì¡ŒìŠµë‹ˆë‹¤. ğŸ™Œ